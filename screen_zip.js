asdasdasdasda  function addMouseEvents(a,b,c){for(var d=["click","dblclick","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","mouseenter","mouseout"],e={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},f=0;f<d.length;f++)$(b).bind(d[f],function(b){var d=b.type,f=c.getPageX(b),g=c.getPageY(b);b.type.indexOf("touch")!=-1&&(d=e[b.type]),c[a.id].eventDetected&&c[a.id].eventDetected({event:d,data:{x:f,y:g}})})}function addKeyboardEvents(a,b,c){for(var d=["keypress","keydown","keyup","blur","change","focus","focusin","focusout"],e=0;e<d.length;e++)$(b).bind(d[e],function(b){var d=b.type,e=c.getPageX(b),f=c.getPageY(b);c[a.id].eventDetected&&c[a.id].eventDetected({event:d,data:{x:e,y:f}})})}function addDragEvent(a,b,c){if(1==a.drag)return!1;var d=!1;0==a.dragRevert&&(d=!0);var e;if(a.dragContainment){e=a.dragContainment.split(",");for(var f=0;f<e.length;f++)e[f]=Number(e[f])}$(b).draggable({revert:d,containment:e,start:function(b,d){c[a.id].eventDetected&&c[a.id].eventDetected({event:"dragStart",data:{id:$(this).attr("id")}})},drag:function(b,d){var e=new Object;e.id=$(this).attr("id"),console.log("drag"),e.x=$(this).offset().left,e.y=$(this).offset().top,c[a.id].eventDetected&&c[a.id].eventDetected({event:"drag",data:e})},stop:function(b,d){var e=parseFloat($(this).css("left"))+parseFloat($(this).parent().css("left")),f=parseFloat($(this).css("top"))+parseFloat($(this).parent().css("top"));$(this).parent().css("left",e),$(this).parent().css("top",f),$(this).css("left",0),$(this).css("top",0),c[a.id].eventDetected&&c[a.id].eventDetected({event:"dragStop",data:{id:$(this).attr("id")}})}})}function addDropEvent(a,b,c){return 1!=a.drop&&void $(b).droppable({drop:function(b,d){c[a.id].eventDetected&&c[a.id].eventDetected({event:"drop",data:{id:$(d.helper).attr("id")}})}})}var cartesian_graph=function(){function E(){c.width=a.width,c.height=a.height,$(c).css({position:"absolute",left:"0px",top:"0px","background-color":a.bgColor}).attr("id","canvas_"+a.id),A=0,B=0,C=c.width,D=c.height,i.width=C+2,i.height=D+2,$(i).css({position:"absolute",left:A+"px",top:B+"px"}).attr("id","canvas_line_"+a.id),e.width=c.width,e.height=c.height,$(e).css({position:"absolute",left:"0px",top:"0px"}).attr("id","canvas_axis_"+a.id),g.width=a.width,g.height=a.height,$(g).css({position:"absolute",left:"0px",top:"0px"}).attr("id","canvas_image_"+a.id),k.width=C+2*a.pointSize,k.height=D+2*a.pointSize,$(k).css({position:"absolute",left:A-a.pointSize+"px",top:B-a.pointSize+"px"}).attr("id","canvas_point_"+a.id),$(k).unbind("touchstart"),$(k).unbind("touchmove"),$(k).unbind("touchend"),$(k).bind("touchstart touchmove touchend",function(a){L(a)}),$(k).unbind("mousedown"),$(k).bind("mousedown",function(a){L(a)}),F()}function F(){o=new Array;var c=A+C,d=B+D;switch(a.zoomValX=a.zoomValX<a.minZoom?a.minZoom:a.zoomValX>a.maxZoom?a.maxZoom:a.zoomValX,a.zoomValY=a.zoomValY<a.minZoom?a.minZoom:a.zoomValY>a.maxZoom?a.maxZoom:a.zoomValY,a.originX){case"left":a.originX=A;break;case"right":a.originX=A+C;break;case"center":a.originX=A+C/2}switch(a.originY){case"top":a.originY=B;break;case"bottom":a.originY=B+D;break;case"center":a.originY=B+D/2}var f=J(0,0);k=13;for(var g=0,h=J(g,0);h.x<c;){var i={points:[{x:h.x,y:B},{x:h.x,y:d}],strokeStyle:0==g?a.axisColor:a.gridColor,lineWidth:0==g?a.axisWidth:a.gridLineWidth,arrows:0==g?"y":""};o.push(i),g+=a.intervalX,h=J(g,0)}for(var g=-1*a.intervalX,h=J(g,0);h.x>A;){var i={points:[{x:h.x,y:B},{x:h.x,y:d}],strokeStyle:0==g?a.axisColor:a.gridColor,lineWidth:0==g?a.axisWidth:a.gridLineWidth,arrows:""};o.push(i),g-=a.intervalX,h=J(g,0)}for(var j=0,k=13,h=J(0,j);h.y>B;){var l=A+k,i={points:[{x:l,y:h.y},{x:c,y:h.y}],strokeStyle:0==j?a.axisColor:a.gridColor,lineWidth:0==j?a.axisWidth:a.gridLineWidth,arrows:0==j?"x":""};o.push(i),j+=a.intervalY,h=J(0,j)}for(j=-1*a.intervalY,h=J(0,j);h.y<d;){var i={points:[{x:A,y:h.y},{x:c,y:h.y}],strokeStyle:0==j?a.axisColor:a.gridColor,lineWidth:0==j?a.axisWidth:a.gridLineWidth,arrows:""};o.push(i),j-=a.intervalY,h=J(0,j)}var m=a.gridLabelFontSize+10;for(u=new Array,v=new Array,xNum=0,h=J(xNum,0);h.x<A+C;){var n;n=f.y>d-m?d-m:f.y<B?B:f.y,h.x>=A&&u.push({label:0==xNum?"":xNum,x:h.x,y:n+a.gridLabelFontSize+5}),xNum+=a.labelIntervalX,xNum=Number(xNum.toFixed(a.toFixedVal)),h=J(xNum,0)}var p=b.getGraphArea().max.x;for(xNum=0,h=J(xNum,0);h.x>A;){if(h.x>A&&xNum<p){var n;n=f.y>d-m?d-m:f.y<B?B:f.y,u.push({label:0==xNum?"":xNum,x:h.x,y:n+a.gridLabelFontSize+5})}xNum-=a.labelIntervalX,xNum=Number(xNum.toFixed(a.toFixedVal)),h=J(xNum,0)}v=new Array,yNum=0,yPix=J(0,yNum);for(var q=a.gridLabelFontSize+15;yPix.y>B;){if(yPix.y<=B+D){var r;r=f.x>c?c:f.x<A+q?A+q:f.x;var l=v.push({label:0==yNum?"":yNum,x:r-8,y:yPix.y+a.gridLabelFontSize/2-2})}yNum+=a.labelIntervalY,yNum=Number(yNum.toFixed(a.toFixedVal)),yPix=J(0,yNum)}var s=b.getGraphArea().min.y;for(yNum=0,yPix=J(0,yNum);yPix.y<d;){if(yPix.y<B+D&&yNum<s){var r;r=f.x>c?c:f.x<A+q?A+q:f.x,v.push({label:0==yNum?"":yNum,x:r-8,y:yPix.y+a.gridLabelFontSize/2-2})}yNum-=a.labelIntervalY,yNum=Number(yNum.toFixed(a.toFixedVal)),yPix=J(0,yNum)}G()}function G(b,e){var f=c,g=d,l=new Object;b&&e&&(f=b,g=e),f.width=f.width,g.beginPath(),g.save(),g.rect(A,B,C,D),g.fillStyle=a.gridBgColor,g.fill(),g.restore(),g.closePath();for(var p=0;p<o.length;p++){g.beginPath(),g.strokeStyle=a.gridColor,g.lineWidth=a.gridLineWidth,o[p].strokeStyle?g.strokeStyle=o[p].strokeStyle:null,o[p].lineWidth?g.lineWidth=o[p].lineWidth:null;for(var q=o[p].points,r=0;r<q.length;r++)q[r].x>=A&&q[r].x<=A+C&&q[r].y>=B&&q[r].y<=B+D&&(0==r?g.moveTo(q[r].x,q[r].y):g.lineTo(q[r].x,q[r].y));if(o[p].text){var s=o[p].text;g.fillStyle=a.labelFontColor,g.font=a.gridLabelFontStyle+" "+a.gridLabelFontSize+"px "+a.labelFontFamily,g.textAlign=s.textAlign?s.textAlign:"left",g.fillText(s.txt,s.x,s.y)}g.stroke(),"x"==o[p].arrows?l.y=o[p].points[0].y:"y"==o[p].arrows&&(l.x=o[p].points[0].x)}for(var t=0;t<u.length;t++){var s=u[t];if(g.fillStyle=a.labelFontColor,g.font=a.gridLabelFontStyle+" "+a.gridLabelFontSize+"px "+a.labelFontFamily,g.textAlign="center",s.label.toString().length>0){var w=Math.abs(s.label);g.fillText(w+a.axisLabelXSuffix,s.x,s.y),g.fillStyle=a.labelFontColor,g.font=a.gridLabelFontStyle+" "+a.gridLabelFontSize+"px "+a.labelFontFamily,g.textAlign="right",g.fillText(s.label<0?"–":"",s.x-g.measureText(w+a.axisLabelXSuffix).width/2-2,s.y)}}for(var t=0;t<v.length;t++){var s=v[t];if(g.fillStyle=a.labelFontColor,g.font=a.gridLabelFontStyle+" "+a.gridLabelFontSize+"px "+a.labelFontFamily,g.textAlign="right",s.label.toString().length>0){var w=Math.abs(s.label);w=s.label<0?"–"+w:w,g.fillText(w+a.axisLabelYSuffix,s.x+11.5,s.y)}}a.labelX&&$(m).html(a.labelX),a.labelY&&$(n).html(a.labelY),g.beginPath(),g.fillStyle=a.axisColor;var x=14;l.y<B?l.y=B:l.y>B+D?l.y=B+D:(g.moveTo(A+C,l.y),g.lineTo(A+C-x,l.y-x/2),g.lineTo(A+C-x,l.y+x/2),g.lineTo(A+C,l.y),g.moveTo(A,l.y),g.lineTo(A+x,l.y-x/2),g.lineTo(A+x,l.y+x/2),g.lineTo(A,l.y));var x=14;l.x<A?l.x=A:l.x>A+C?l.x=A+C:(g.moveTo(l.x,B),g.lineTo(l.x-x/2,B+x),g.lineTo(l.x+x/2,B+x),g.lineTo(l.x,B),g.moveTo(l.x,B+D),g.lineTo(l.x-x/2,B+D-x),g.lineTo(l.x+x/2,B+D-x),g.lineTo(l.x,B+D)),g.fill(),l.y<B+30&&(l.y=B+30),l.x>A+C-35&&(l.x=A+C-35),a.labelX&&$(m).css({bottom:-(l.y-5)+"px",right:-(A+C)+"px"}),a.labelY&&$(n).css({left:l.x+15+"px",top:B+"px"})}function H(){i.width=i.width;for(var a=0;a<s.length;a++)if(s[a]){var b=s[a].point;j.beginPath(),j.lineWidth=s[a].lineWidth,j.lineCap="round";for(var c=0;c<b.length;c++){var d=J(b[c].x,b[c].y,!0);if(c>0){var e=J(b[c-1].x,b[c-1].y,!0);s[a].allowParse?(j.moveTo(e.x,e.y),j.lineTo(d.x,d.y)):(j.moveTo(e.x,e.y),j.lineTo(d.x,d.y))}}if(j.strokeStyle=s[a].color,j.stroke(),s[a].showArrow){var f=b.length-1,g=J(b[f-1].x,b[f-1].y,!0),h=J(b[f].x,b[f].y,!0);O(g,h,j,s[a].lineWidth,s[a].color)}j.closePath()}}function I(){k.width=k.width;for(var c=0;c<t.length;c++)if(t[c]){var d=t[c],e=b.getGraphArea();if(d.x>=e.min.x&&d.x<=e.max.x&&d.y<=e.min.y&&d.y>=e.max.y){var f=J(d.x,d.y,!0),g=Math.max(0,d.radius-2),h=f.x+a.pointSize,i=f.y+a.pointSize;l.beginPath(),l.arc(h,i,g,0,2*Math.PI),l.fillStyle=d.color,l.fill()}}}function J(b,c,d){var e,f;return d?(e=a.originX+b*(a.unitX*a.zoomValX),f=a.originY+-1*c*(a.unitY*a.zoomValY)):(e=a.originX+b*(a.unitX*a.zoomValX),f=a.originY+-1*c*(a.unitY*a.zoomValY)),{x:e,y:f}}function K(b,c,d){var e,f;return d?(e=(b-(a.originX-A))/(a.unitX*a.zoomValX),f=(c-(a.originY-B))/(a.unitY*a.zoomValY)):(e=(b-(a.originX-A))/(a.unitX*a.zoomValX),f=-1*((c-(a.originY-B))/(a.unitY*a.zoomValY))),{x:e,y:f}}function L(c){if(!c)return!1;if("mouseover"==c.type||"mouseout"==c.type)return!1;"touchstart"!=c.type&&"touchmove"!=c.type||(x=c.touches[0].pageX,y=c.touches[0].pageY),"touchend"==c.type&&(c={touches:[{pageX:x,pageY:y}],type:"touchend",preventDefault:function(){return!1}}),"mousemove"!=c.type&&"mousedown"!=c.type&&"mouseup"!=c.type||(c.touches=[{pageX:c.pageX,pageY:c.pageY}]);var d=K(c.touches[0].pageX-$(k).offset().left,c.touches[0].pageY-$(k).offset().top,!0);({x:c.touches[0].pageX-$(k).offset().left-a.pointSize,y:c.touches[0].pageY-$(k).offset().top-a.pointSize}),{x:d.x,y:d.y};if("touchstart"!=c.type&&"mousedown"!=c.type||(p=void 0,q=void 0,r=void 0,w=!0),"touchmove"==c.type||"mousemove"==c.type){if(1==c.touches.length&&(a.panX||a.panY)&&w){var g=!1;a.panX&&(Math.abs(p-c.touches[0].pageX)>10||void 0==p)&&(void 0!=p&&(a.originX+=c.touches[0].pageX-p,g=!0),p=c.touches[0].pageX),a.panY&&(Math.abs(q-c.touches[0].pageY)>10||void 0==q)&&(void 0!=q&&(a.originY+=c.touches[0].pageY-q,g=!0),q=c.touches[0].pageY),g&&F(),M("pan")}if(2==c.touches.length){var h={x:b.getGraphArea().center.x,y:b.getGraphArea().center.y},i=J(b.getGraphArea().center.x,b.getGraphArea().center.y),j=N(c.touches[0].pageX,c.touches[0].pageY,c.touches[1].pageX,c.touches[1].pageY);if((a.zoomX||a.zoomY)&&(Math.abs(j-r)>10||void 0==r)){if(j-r<0){a.zoomX&&a.zoomValX>a.minZoom?a.zoomValX-=.1:null,a.zoomY&&a.zoomValY>a.minZoom?a.zoomValY-=.1:null;var l=J(h.x,h.y);!isNaN(a.originX)&&a.zoomFromCenterX&&(a.originX+=i.x-l.x),!isNaN(a.originY)&&a.zoomFromCenterY&&(a.originY+=i.y-l.y),F()}if(j-r>0){a.zoomX&&a.zoomValX<a.maxZoom?a.zoomValX+=.1:null,a.zoomY&&a.zoomValX<a.maxZoom?a.zoomValY+=.1:null;var l=J(h.x,h.y);!isNaN(a.originX)&&a.zoomFromCenterX&&(a.originX+=i.x-l.x),!isNaN(a.originY)&&a.zoomFromCenterY&&(a.originY+=i.y-l.y),F()}r=j}M("zoom")}}"mousedown"==c.type&&($(window).unbind("mousemove",L).bind("mousemove",L),$(window).unbind("mouseup",L).bind("mouseup",L)),"mouseup"!=c.type&&"touchend"!=c.type||($(window).unbind("mousemove",L),$(window).unbind("mouseup",L),w=!1),c.preventDefault()}function M(a,b){G(),H(),I()}function N(a,b,c,d){var e=Math.abs(Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)));return e}function O(a,b,c,d,e){var f=Math.PI+R(a,b,!0),g=new Object,h=new Object,i=new Object,j=f,k=f-.5;g.x=b.x-15*Math.cos(j),g.y=b.y-15*Math.sin(j),h.x=b.x-5*Math.cos(f),h.y=b.y-5*Math.sin(f),i.x=b.x-15*Math.cos(k),i.y=b.y-15*Math.sin(k),c.beginPath(),c.moveTo(b.x,b.y),c.lineTo(g.x,g.y),c.lineTo(h.x,h.y),c.lineTo(i.x,i.y),c.lineTo(b.x,b.y),c.lineWidth=d,c.lineJoin="round",c.fillStyle=e,c.strokeStyle=e,c.fill(),c.stroke(),c.closePath()}function P(){a.labelX&&!m&&(m=document.createElement("div"),a.target.append(m),$(m).css({position:"absolute","font-weight":"bold","pointer-events":"none","font-size":a.axisgridLabelFontSize+"px","white-space":"nowrap"})),a.labelY&&!n&&(n=document.createElement("div"),a.target.append(n),$(n).css({position:"absolute","font-weight":"bold","pointer-events":"none","white-space":"nowrap","font-size":a.axisgridLabelFontSize+"px","padding-right":"2px","padding-bottom":"2px"}))}function Q(a){for(var b=0;b<a.length;b++)"undefined"==typeof a[b]&&(a.splice(b,1),b--)}function R(a,b,c){return c?Math.atan2(a.y-b.y,a.x-b.x):Math.atan2(a.y-b.y,a.x-b.x)*(180/Math.PI)}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,u,v,x,y,a={width:500,height:500,panX:!0,panY:!0,axisgridLabelFontSize:25,gridColor:"#808080",axisColor:"#ff0000",gridLineWidth:2,bgColor:"#FFFFFF",gridBgColor:"rgba(255,231,231,1)",pointSize:10,unitX:60,unitY:60,labelIntervalX:1,labelIntervalY:1,intervalX:1,intervalY:1,originX:"center",originY:"center",axisLabelXSuffix:"",axisLabelYSuffix:"",axisWidth:4,labelFontFamily:"'Nunito', sans-serif",gridLabelFontSize:18,gridLabelFontStyle:"italic",labelFontColor:"#000000",toFixedVal:1,customImageIndex:0,zoomX:!0,zoomY:!0,zoomFromCenterX:!0,zoomFromCenterY:!0,maxZoom:2,minZoom:.5,zoomValX:1,zoomValY:1},b=this,s=new Array,t=new Array,w=!1,z=new Array;this.init=function(b){for(var m in b)a[m]=b[m];c=document.createElement("canvas"),d=c.getContext("2d"),e=document.createElement("canvas"),f=e.getContext("2d"),g=document.createElement("canvas"),h=g.getContext("2d"),i=document.createElement("canvas"),j=i.getContext("2d"),k=document.createElement("canvas"),l=k.getContext("2d");var n=document.createElement("div");a.target?a.target.append(n):$("body").append(n),a.target=$(n),a.target.css({position:"absolute",left:a.x+"px",top:a.y+"px"}),a.target.append(c),a.target.append(g),a.target.append(i),a.target.append(e),a.target.append(k),a.customImageIndex&&$(g).css({"z-index":a.customImageIndex}),a.customLineCanvas&&$(i).css({"z-index":a.customLineCanvas}),a.customPointCanvas&&$(k).css({"z-index":a.customPointCanvas}),a.pointIndex&&$(k).css({"z-index":a.pointIndex}),P(),E()},this.updateParams=function(b){for(var c in b)a[c]=b[c]},this.getGraphArea=function(){var a=K(0,0),b=K(C,D),c=K(C/2,D/2);return{min:{x:a.x,y:a.y},max:{x:b.x,y:b.y},center:{x:c.x,y:c.y}}},this.drawLines=function(a,b){if(void 0==a.id||void 0==a.data)return!1;var c=a.data,d=a.id;s[d]||(s[d]={point:[],color:"#000000",lineWidth:2}),a.reset&&(s[d].point=new Array);for(var e=0;e<c.length;e++)s[d].point.push({x:c[e].x,y:c[e].y});a.color&&(s[d].color=a.color),a.lineWidth&&(s[d].lineWidth=Math.max(a.lineWidth,1)),a.borderWidth&&a.borderColor&&(s[d].borderWidth=a.borderWidth,s[d].borderColor=a.borderColor),a.showArrow?s[d].showArrow=a.showArrow:s[d].showArrow=null,a.pan?s[d].pan=!0:s[d].pan=!1,b||H()},this.drawPoints=function(b,c){z.indexOf(b.id)==-1&&z.push(b.id),Q(z),b.xPix=b.x,b.yPix=b.y,t[b.id]=b,t[b.id].radius="undefined"!=typeof b.radius?b.radius:a.pointSize,c||I()},this.setZoom=function(b,c,d,e){"reset"==b?a.zoomValX=a.zoomValY=1:"increase"==b?(a.zoomValX=d?a.zoomValX+c:a.zoomValX,a.zoomValY=e?a.zoomValY+c:a.zoomValY):"decrease"==b&&(a.zoomValX=d?a.zoomValX-c:a.zoomValX,a.zoomValY=e?a.zoomValY-c:a.zoomValY),M("zoom"),F()},this.clean=function(a){void 0!=a?(s[a]=void 0,t[a]=void 0):(s=new Array,t=new Array),H(),I()},this.resetGraph=function(c,d){var e=d?d:{x:b.getGraphArea().center.x,y:b.getGraphArea().center.y},f=d?J(d.x,d.y):J(b.getGraphArea().center.x,b.getGraphArea().center.y);b.updateParams(c);var g=J(e.x,e.y);!isNaN(a.originX)&&a.zoomFromCenterX&&(a.originX+=f.x-g.x),!isNaN(a.originY)&&a.zoomFromCenterY&&(a.originY+=f.y-g.y),P(),F(),H(),I(),M("zoom")},this.getPixelVal=function(a,b,c){return J(a,b,c)},this.getPointVal=function(a,b,c){return K(a,b,c)},this.setPanX=function(b,c,d){a.originX=A,a.originX=-1*J(b-1,0,!0).x,F(),c||H(),d||I()},this.setPanY=function(b){a.originY=B,a.originY=-1*J(0,b-1,!0).y,F(),H(),I()},this.scratchPad=function(){return g};var A,B,C,D},cursorArr=["auto","crosshair","default","e-resize","grab","help","move","n-resize","ne-resize","nw-resize","pointer","progress","s-resize","se-resize","sw-resize","text","w-resize","wait","not-allowed","no-drop"],mediaEvents=["abort","canplay","canplaythrough","durationchange","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],textDecorationArr=["none","underline","overline","line through","blink"],textTransformArr=["none","capitalize","lowercase","uppercase"],fontFamilyArr=['"Nunito", sans-serif','"Dekko", cursive','"Acme", sans-serif',"Arial, Helvetica, sans-serif",'"Arial Black", Gadget, sans-serif','"Times New Roman", Times, serif',"Verdana, Geneva, sans-serif","Georgia, serif",'"Trebuchet MS", Helvetica, sans-serif','"Courier New", Courier, monospace','"Lucida Console", Monaco, monospace','"Comic Sans MS", cursive, sans-serif',"Impact, Charcoal, sans-serif",'"Lucida Sans Unicode", "Lucida Grande", sans-serif',"Tahoma, Geneva, sans-serif",'"Palatino Linotype", "Book Antiqua", Palatino, serif'],fontStyleArr=["normal","italic","oblique","initial","inherit"],fontWeightArr=["normal","bold","bolder","lighter","initial","inherit","100","200","300","400","500","600","700","800","900"],textAlignArr=["left","center","right"],textVerticalAlignArr=["top","middle","bottom"],wordWrap=["normal","break-word","initial","inherit"],inputTypes=["text","number","color"],imageFilterArr=["normal","grayScale","negative","bright","threshold","sharp","blur"],btnThemes=["btn-default","btn-primary","btn-success","btn-info","btn-warning","btn-danger"],videoTypes=["Direct MP4","YouTube"],ScreenController=function(a){function e(a){loadAll(a)}function f(a){var c=new Array;for(var d in b)b[d].target&&b[d].target==a&&c.push(b[d]);return c}function h(){d++,d==b.globalImageArr.length&&setTimeout(function(){console.log("all images loaded"),b.startScreen()},100);var a=d/b.globalImageArr.length*100;a=a.toFixed(2),$(".imageLoderText").html("Loading images ...."+a+"%")}var b=this;this.audio=new Object,this.baseLayer=$("#_screen"),this.audioEngine(!0),this.globalImageArr=new Array,this.updateObj=function(a,b){for(var c in b)a[c]=b[c];return a},this.getRandomColor=function(){for(var a="0123456789ABCDEF",b="#",c=0;c<6;c++)b+=a[Math.floor(16*Math.random())];return b},this.updateObjKeys=function(a,b){new Array,new Array;for(var e in b)(a[e]||0==a[e])&&(a[e]=b[e]);return a},this.alert=function(a){connectInterface({id:"alert",data:a})};var c=new Object;c.createTag=function(a,b){var c=document.createElement(a);return $(c).attr("data-name",b),c},c.applyCSS=function(a,b){$(a).css(b)},c.appendChild=function(a,b){$(a).append(b)},this.html=c,this.error=function(a){console.log("error : ",a)},this.getPageX=function(a){return"touchmove"==a.type||"touchstart"==a.type?a.originalEvent.touches[0].pageX:a.clientX},this.getPageY=function(a){return"touchmove"==a.type||"touchstart"==a.type?a.originalEvent.touches[0].pageY:a.clientY};var d=0;this.loadImages=function(a){console.log("globalImageArr.push"),b.globalImageArr.push(a)},this.startImageLoader=function(){if(b.globalImageArr.length>0)for(var a=0;a<b.globalImageArr.length;a++){var c=new Image;c.crossOrigin="Anonymous",c.src=b.globalImageArr[a],c.onload=h}else $(".innerPageLoader").fadeOut(1e3);var d=b.globalImageArr.slice();e(d)},this.startScreen=function(){console.log("startScreen"),b.loaded&&b.loaded(),b.audio.playMP3();var a=f("audio");for(var c in a){var d=a[c].read("config");console.log("_config = ",d),0==d.autoplay&&a[c].write("play")}$(".innerPageLoader").fadeOut(1e3),connectInterface({id:"screenStarted"})},this.createFile=function(a,b){var c;if("[object Blob]"==a.toString())c=a;else var d=JSON.stringify(a),c=new Blob([d],{type:"octet/stream"});var e=document.createElement("a");document.body.appendChild(e),e.style="display: none",url=window.URL.createObjectURL(c),e.href=url,e.download=b,e.click(),console.log("url === ",url),window.URL.revokeObjectURL(url)},this.background=function(a){if(0==b._length(a))return!1;if(1==a.bgOption)$("#_screen").parent().css("background",a.bgColor);else{var c=new Image;c.crossOrigin="Anonymous";var d="";a.bg.indexOf("default")!=-1?(d="images/default-blue.jpg",a.bg.indexOf("blue")!=-1&&(d="images/default-blue.jpg"),a.bg.indexOf("black")!=-1&&(d="images/default-black.jpg")):d=a.bg,c.src=d,b.globalImageArr.push(c.src),c.onload=function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height;var b=a.getContext("2d");b.drawImage(this,0,0),console.log(this);var c=a.toDataURL();$("#_screen").parent().css("background","#cccccc url("+c+")"),$("#_screen").parent().css("background-size","100% 100%")}}};var i=!1;$("#_screen").mousedown(function(a){i=!0}),$("#_screen").mousemove(function(a){i&&b.mouseDrag&&b.mouseDrag({x:a.offsetX,y:a.offsetY})}),$("#_screen").mouseup(function(a){i=!1}),this.createElementHolder=function(a){b[a.id]=new Object,b[a.id].elem=$(document.createElement("div")),b[a.id].elem.css({position:"absolute",left:a.x+"px",top:a.y+"px"}),b[a.id].type="instance",b[a.id].elem.draggable({stop:function(b,c){a.x=String($(this).offset().left),a.y=String($(this).offset().top),window.parent.connectInterface(a)}}),b[a.id].elem.addClass("elementHolder")},this.updateElementHolder=function(a,c){b[a.id].elem.append(c)},this._length=function(a){var b=0;for(var c in a)b++;return b},this.closeElementHolder=function(a){var c=document.createElement("div");$(c).addClass("_dragHandle"),b[a.id].showDrag=function(d){d?("image"==b[a.id].target&&$(c).parent().find("img").css({left:"0px",top:"0px"}),$(c).show()):$(c).hide()},$(c).attr("data",a.id),$(c).dblclick(function(){var b=$(this).attr("data");connectInterface({id:"showComponentPopUp",data:a}),console.log("_id = ",b)}),b[a.id].elem.append(c),b[a.id].elem.draggable("option","handle",c),b.baseLayer.append(b[a.id].elem)},window.addEventListener("keydown",function(a){b.keydown&&b.keydown(a)},!1),window.addEventListener("keyup",function(a){b.keyup&&b.keyup(a)},!1),window.addEventListener("keypress",function(a){b.keypress&&b.keypress(a)},!1)};ScreenController.prototype.addText=function(a){function g(a){if(d.empty(),d.html("<span style='display:table-cell;vertical-align:"+textVerticalAlignArr[c.textVerticalAlign]+"'>"+a+"</span>"),1==c.type){var b=String(a).replace(/\\/g,"\\\\");b="\\\\bold {"+b+"}",h(d[0],stripslashes(b))}}function h(a,b){b=i(b),katex.render(b,a),$(a).css({opacity:1})}function i(a){return a=a.replace(/\\boldsymbol/g,""),a=a.replace(/\\bullet/g,"\\cdot"),a=a.replace(/\\bf/g,""),a=a.replace(/\•/g,"\\cdot"),a=a.replace(/\–/g,"-"),a=a.replace(/\&ndash;/g,"-"),a=a.replace(/π/g,"\\pi")}var b=this,c={id:"text_1",func:"addText",parentComponent:"text",cls:"text_plugin",x:0,y:0,width:300,height:"auto",opacity:1,value:"Sample Text",type:0,color:"#000000",bgColor:"#ffffff",bgShow:1,fontSize:30,fontFamily:0,fontStyle:0,fontWeight:0,textDecoration:0,textTransform:0,textAlign:0,textVerticalAlign:0,wordSpacing:0,letterSpacing:0,wordWrap:0,textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"#cccccc",startTime:0,stopTime:0};if(a.parentComponent="text",a.cls="text_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="text";var d=$("<div></div>");b[a.id].obj=d,d.attr("data",a.id),d.attr("id",a.id),d.addClass("text_plugin");var e=c.bgColor;1==c.bgShow&&(e="transparent"),d.css({display:"table",padding:"10px","font-family":fontFamilyArr[c.fontFamily],"font-weight":fontWeightArr[c.fontWeight],"font-style":fontStyleArr[c.fontStyle],background:e,"font-size":c.fontSize+"px",color:c.color,width:c.width+"px",height:c.height+"px",opacity:c.opacity,"text-align":textAlignArr[c.textAlign],"letter-spacing":c.letterSpacing+"px","text-decoration":textDecorationArr[c.textDecoration],"text-transform":textTransformArr[c.textTransform],"word-spacing":c.wordSpacing+"px","word-wrap":wordWrap[c.wordWrap]}),0==c.textShadowX&&0==c.textShadowY||d.css({"text-shadow":c.textShadowX+"px "+c.textShadowY+"px "+c.textShadowBlur+"px "+c.textShadowColor});var f=c.value.replace(/#semicolon#/g,";");g(f),b[a.id].read=function(a,b){var e;switch(a){case"value":e=d.html();break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=d.offset().left;break;case"top":e=d.offset().top;break;case"width":e=d.width();break;case"height":e=d.height();break;case"css":e=css(_div)}return e},b[a.id].write=function(a,b){switch(a){case"show":d.show();break;case"hide":d.hide();break;case"value":g(b);break;case"css":d.css(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addTextArea=function(a){var b=this,c={id:"textArea_1",func:"addTextArea",parentComponent:"textArea",cls:"textArea_plugin",x:0,y:0,width:300,height:200,opacity:1,value:50,placeHolder:"write text here",color:"#666666",bgColor:"#ffffff",fontSize:30,fontFamily:0,fontStyle:0,fontWeight:0,textDecoration:0,textTransform:0,textAlign:0,wordSpacing:0,letterSpacing:0,wordWrap:0,textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"#cccccc",startTime:0,stopTime:0};if(a.parentComponent="textArea",a.cls="textArea_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="textArea";var d=$(' <textarea placeHolder="'+c.placeHolder+'" type="text" class="form-control"></textarea>');d.attr("data",a.id),d.attr("id",a.id),d.addClass("textArea_plugin");var e=String(c.value).replace(/#semicolon#/g,";");$(d).val(e),$(d).css({"font-size":c.fontSize+"px",width:c.width+"px",height:c.height+"px",color:c.color,background:c.bgColor,opacity:c.opacity,"font-family":fontFamilyArr[c.fontFamily],"font-weight":fontWeightArr[c.fontWeight],"font-style":fontStyleArr[c.fontStyle],"letter-spacing":c.letterSpacing+"px","text-decoration":textDecorationArr[c.textDecoration],"text-transform":textTransformArr[c.textTransform],"word-spacing":c.wordSpacing+"px","text-shadow":c.textShadowX+"px "+c.textShadowY+"px "+c.textShadowBlur+"px "+c.textShadowColor,"box-shadow":"2px 2px 2px 2px #cccccc"}),addKeyboardEvents(c,d,b),b[c.id].eventDetected=function(a){b[c.id].listener&&b[c.id].listener(a)},b[a.id].read=function(a,b){var e;switch(a){case"value":e=$(d).val();break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(console.log("textfeild write"),a){case"show":d.show();break;case"hide":d.hide();break;case"value":$(d).val(b);break;case"css":$(d).css(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addTextFeild=function(a){function f(a){var d=c.connect.split(",");console.log("_arr = ",d);for(var e=0;e<d.length;e++)b[d[e]]&&b[d[e]].write("value",a)}function k(a){var b=0,c=0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}}function l(a,b,c){if(a>255||b>255||c>255)throw"Invalid color component";return(a<<16|b<<8|c).toString(16)}function m(){console.log("showColorCanvas")}var b=this,c={id:"textFeild_1",func:"addTextFeild",parentComponent:"textFeild",cls:"textFeild_plugin",x:0,y:0,width:120,height:50,opacity:1,type:0,value:50,placeHolder:"write text here",color:"#666666",bgColor:"#ffffff",fontSize:30,fontFamily:0,fontStyle:0,fontWeight:0,textDecoration:0,textTransform:0,textAlign:0,wordSpacing:0,letterSpacing:0,wordWrap:0,textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"#cccccc",connect:"",startTime:"0",stopTime:"0"};if(a.parentComponent="textFeild",a.cls="textFeild_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="textFeild";var d;switch(console.log("p.type = ",c.type),c.type){case 2:d=$(' <input  placeHolder="'+c.placeHolder+'" class="form-control customColor" value="#000000">');break;default:d=$(' <input type="'+inputTypes[c.type]+'" placeHolder="'+c.placeHolder+'" class="form-control">');var e=String(c.value).replace(/#semicolon#/g,";");console.log("_txt = ",e),$(d).val(e)}if(d.attr("data",a.id),d.attr("id",a.id),d.addClass("textFeild_plugin"),console.log("p.value = ",c.value),$(d).css({"font-size":c.fontSize+"px",width:c.width+"px",height:c.height+"px",opacity:c.opacity,color:c.color,background:c.bgColor,"font-family":fontFamilyArr[c.fontFamily],"font-weight":fontWeightArr[c.fontWeight],"font-style":fontStyleArr[c.fontStyle],"letter-spacing":c.letterSpacing+"px","text-decoration":textDecorationArr[c.textDecoration],"text-transform":textTransformArr[c.textTransform],"word-spacing":c.wordSpacing+"px","text-shadow":c.textShadowX+"px "+c.textShadowY+"px "+c.textShadowBlur+"px "+c.textShadowColor}),addKeyboardEvents(c,d,b),b[c.id].eventDetected=function(a){"keyup"==a.event&&f($(d).val());var e=$(d).val();"number"==inputTypes[c.type]&&(e=Number(e)),a.data.value=e,b[c.id].listener&&b[c.id].listener(a)},b[a.id].read=function(a,b){var e;switch(a){case"value":e=$(d).val(),"number"==inputTypes[c.type]&&(e=Number(e));break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(console.log("textfeild write"),a){case"show":d.show();break;case"hide":d.hide();break;case"value":$(d).empty(),$(d).val(b);break;case"css":$(d).css(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c),2==c.type){$(d).css({background:"#000000",color:"#ffffff"});var g=document.createElement("canvas");$(d).bind("click",function(a){a.stopImmediatePropagation(),2==c.type&&$(g).fadeIn(500)}),g.width=256,g.height=256;var h=g.getContext("2d");$(g).attr("class","colorCanvas"),$(g).css({background:"#000000",cursor:"crosshair"}),$(g).hide();var i=new Image;i.src="images/color_map.png",i.onload=function(){h.drawImage(i,0,0)};var j=!1;$(g).mousedown(function(a){j=!0}),$(g).mouseup(function(a){j=!1,$(d).trigger("change")}),$(g).mousemove(function(a){if(!j)return!1;var b=k(this),c=a.pageX-b.x,e=a.pageY-b.y,g=this.getContext("2d"),h=g.getImageData(c,e,1,1).data,i="#"+("000000"+l(h[0],h[1],h[2])).slice(-6);console.log("hex = ",i),$(d).val(i),$(d).css({background:i})}),b[c.id].elem.append(g),$(d).bind("mousedown",m)}}},ScreenController.prototype.addVideo=function(a){function h(){var a=function(a){alert("An error has occurred!",a)},b={video:!0};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(b).then(function(a){g=a.getTracks()[0],$(e)[0].src=window.URL.createObjectURL(a),$(e)[0].play()}):navigator.getUserMedia?navigator.getUserMedia(b,function(a){g=a.getTracks()[0],$(e)[0].src=a,$(e)[0].play()},a):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(b,function(a){g=a.getTracks()[0],$(e)[0].src=window.webkitURL.createObjectURL(a),$(e)[0].play()},a):navigator.mozGetUserMedia&&navigator.mozGetUserMedia(b,function(a){g=a.getTracks()[0],$(e)[0].src=window.URL.createObjectURL(a),$(e)[0].play()},a)}function i(){g.stop()}var b=this,c={id:"video_1",func:"addVideo",parentComponent:"video",cls:"video_plugin",x:0,y:0,width:400,height:300,opacity:1,src:"http://www.w3schools.com/html/mov_bbb.mp4",type:0,startTime:"0",stopTime:"0"};if(a.parentComponent="video",a.cls="video_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{if(b.createElementHolder(c),b[a.id].target="video",1==c.type){var d=c.src.split("v=")[1];console.log("_link = ",d);var e=$('<div class="embed-responsive embed-responsive-16by9"> <iframe  class="embed-responsive-item" id="youTubeAppLink" src="https://www.youtube.com/embed/'+d+'" frameborder="0" allowfullscreen></iframe> </div>')}else var e=$('<video poster="images/poster.jpg" width="400"  controls><source src="'+c.src+'" type="video/mp4"><img src="images/poster.jpg" ></video>');e.attr("data",a.id),e.attr("id",a.id),e.addClass("video_plugin"),$(e).val(c.val),$(e).css({"font-size":c.fontSize+"px",width:c.width+"px",height:c.height+"px",opacity:c.opacity,color:c.color,background:"#000000"});for(var f=0;f<mediaEvents.length;f++)$(e).off(mediaEvents[f]).on(mediaEvents[f],function(a){b[c.id].listener&&b[c.id].listener({event:a.type})});b[a.id].read=function(a,b){var d;switch(a){case"time":d=$(e)[0].currentTime;break;case"domElem":d=e;break;case"config":d=c;break;case"left":d=$(e).offset().left;break;case"top":d=$(e).offset().top;break;case"width":d=$(e).width();break;case"height":d=$(e).height();break;case"css":d=css(e)}return d};var g;b[a.id].write=function(a,b){switch(console.log("textfeild write"),a){case"show":e.show();break;case"hide":e.hide();break;case"openWebcam":h();break;case"closeWebcam":
i();break;case"css":$(e).css(b);break;case"play":$(e)[0].play();break;case"pause":$(e)[0].pause();break;case"time":$(e)[0].currentTime=b;break;case"stop":e.pause(),$(e)[0].currentTime=.1}},b.updateElementHolder(c,e),b.closeElementHolder(c)}},ScreenController.prototype.audioEngine=function(a){function g(a){console.log("gotBuffers"),f.exportWAV(h)}function h(a){screen.createFile(a,"myRecording.wav")}function p(){console.log("togglePlayPause"),q(screenAudio)?screenAudio.pause():(screenAudio.play(),x())}function q(a){return!a.paused}function s(a){switch(a.event){case"abort":break;case"canplay":break;case"canplaythrough":var d=screenAudio.duration;$(o).attr("class").indexOf("ui-slider")!=-1&&$(o).slider("option","max",d),b.audioLoaded&&(console.log("_duration ",d),b.audioLoaded(Number(d.toFixed(2)))),x();break;case"durationchange":break;case"ended":break;case"error":break;case"loadeddata":break;case"loadedmetadata":break;case"loadstart":break;case"pause":console.log("update pause"),$(n).html('<span class="glyphicon glyphicon-play" aria-hidden="true"></span>'),clearInterval(c);break;case"play":$(n).html('<span class="glyphicon glyphicon-pause" aria-hidden="true"></span>');break;case"playing":break;case"progress":w();break;case"ratechange":break;case"seeked":break;case"seeking":break;case"stalled":break;case"suspend":break;case"timeupdate":$(n).html('<span class="glyphicon glyphicon-pause" aria-hidden="true"></span>');break;case"volumechange":break;case"waiting":}}function w(){screenAudio.buffered.length&&(v=screenAudio.buffered.end(0)/screenAudio.duration*100,$(k).html("Audio Load Buffer : "+v.toFixed(2)+"%"))}function x(){clearInterval(c),c=setInterval(function(){y()},100)}function y(){var a=Number(screenAudio.currentTime.toFixed(1));b.audioTimeline&&b.audioTimeline(a),$(o).attr("class").indexOf("ui-slider")!=-1&&$(o).slider("value",a),A(),C()}function z(a){var b=String(a).split(".")[0],c=String(a).split(".")[1];return c||(c="0"),1==c.length&&(c+="0"),b+"."+c}function A(){var a=Number(screenAudio.currentTime.toFixed(2)),b=Number(screenAudio.duration.toFixed(2));a=z(a),b=z(b),$(j).html(a+" / "+b)}function C(){$(l).empty(),$(l).append("Timeline Objects:");var a="";$(".timelineObjects").hide();for(var b=B;b<t.length;b++){var c=Number(t[b].read("config").startTime),d=Number(t[b].read("config").stopTime);c<screenAudio.currentTime&&screenAudio.currentTime<d&&(a+=" "+t[b].read("config").id+",",t[b].write("show"))}a=a.substring(0,a.length-1),$(l).append(" <span style='font-style:italic'>"+a+"</span>")}var c,b=this,d=!0,e=b.audio;globalAudioContext&&(e.audioContext=globalAudioContext,e.analyserNode=e.audioContext.createAnalyser());var f;if(e.recorder=function(a){f=new Recorder(a)},e.recorderStart=function(a){f.clear(),f.record()},e.recorderStop=function(a){f.stop()},e.recorderSave=function(a){f.getBuffers(g)},a){detectmob()&&$("#playBtnHolder").show(),e.oscillatorRecordStart=function(a){e.recorder(a)},e.oscillatorRecordStop=function(){e.recorderStop()},e.oscillatorRecordSave=function(){e.recorderSave()},e.oscillator=function(a){console.log("audioOscillator");var c={bpm:120,noteLength:4,waveType:"sine",freqStart:50,freqEnd:50,gainStart:1,gainEnd:.001,pulseDuration:null};b.updateObj(c,a),0==c.freqStart&&(c.freqStart=.001),0==c.freqEnd&&(c.freqEnd=.001),0==c.gainStart&&(c.gainStart=.001),0==c.gainEnd&&(c.gainEnd=.001);var d=e.audioContext.createOscillator(),f=e.audioContext.currentTime,g=1/(c.bpm/60)*c.noteLength;c.pulseDuration&&(g=c.pulseDuration);var h=e.audioContext.createGain();e.analyserNode.fftSize=2048,h.connect(e.analyserNode),h.gain.setValueAtTime(c.gainStart,e.audioContext.currentTime),h.gain.exponentialRampToValueAtTime(c.gainEnd,e.audioContext.currentTime+g),h.gain.value=1,d.connect(h),d.frequency.setValueAtTime(c.freqStart,e.audioContext.currentTime),d.frequency.exponentialRampToValueAtTime(c.freqEnd,e.audioContext.currentTime+g),d.type=c.waveType,d.start(f),d.stop(f+g),h.connect(e.audioContext.destination)},e.stopMP3=function(){return!(!r||""==r)&&(console.log("stopMP3 2"),screenAudio.pause(),void clearInterval(c))};var i,j,k,l,m,n,o;e.showPlayer=function(){i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),b.baseLayer.append(i),$(n).addClass("audioPlayBtn"),$(n).bind("mousedown",p),$(j).css({}).addClass("_timerText"),$(k).css({}).addClass("_bufferText"),$(l).css({}).addClass("_timelineText"),$(m).css({}).addClass("_audioPlayerHandle"),$(m).html("Hide Audio Player"),$(i).addClass("playerHolder"),$(n).append('<span class="glyphicon glyphicon-play" aria-hidden="true"></span>'),o=document.createElement("div"),$(i).append(o),$(i).append(j),$(i).append(k),$(i).append(l),$(i).append(m),$(i).append(n),$(m).click(function(a){var b=parseFloat($(i).css("bottom"));console.log("click on player _bottom ",b),0==b?$(i).animate({bottom:-$(i).height()},500,function(){$(m).html("Show Audio Player")}):$(i).animate({bottom:"0px"},500,function(){$(m).html("Hide Audio Player")})}),$(o).css({width:"80%",position:"absolute",top:"48px",left:"106px"}),$(o).slider({range:"min",min:0,max:screenAudio.duration,step:1,start:function(a,b){e.stopMP3()},slide:function(a,b){console.log("slide")},stop:function(a,b){e.setAudioTime(b.value),B=0}}),0==d?$(i).show():$(i).hide()};var r;e.mp3=function(a){if(!a)return!1;d=a.player,clearInterval(c),e.showPlayer(),r=a.url,screenAudio.src=a.url;for(var b=0;b<mediaEvents.length;b++)$(screenAudio).off(mediaEvents[b]).on(mediaEvents[b],function(a){s({event:a.type})})},e.audioVolume=function(a){screenAudio.volume=a};var t=new Array;e.createTimeline=function(a){t=a;for(var b=0;b<t.length;b++)$(t[b].read("domElem")).addClass("timelineObjects")},e.playEffect=function(a){_globalAudio.src=globalAudio[a],_globalAudio.play()},e.setAudioTime=function(a){screenAudio.currentTime=a,screenAudio.play(),x()};e.playMP3=function(a,b){return console.log("playMP3 mp3"),a||(a=r),""!=a&&(b&&(screenAudio.currentTime=b),void screenAudio.play())};var v=0,B=0}},ScreenController.prototype._3dEngine=function(a){var b=this;new Object;if(a){$(".gridImage").hide(),b.object3D=new Object,b.enable3D=!0;var d;new THREEx.KeyboardState,new THREE.Clock;b.object3D.scene=new THREE.Scene;var h=window.innerWidth,i=window.innerHeight,j=75,k=h/i,l=.1,m=2e4;b.object3D.camera=new THREE.PerspectiveCamera(j,k,l,m),b.object3D.scene.add(b.object3D.camera),b.object3D.camera.position.set(0,150,400),b.object3D.camera.lookAt(b.object3D.scene.position),Detector.webgl?b.object3D.renderer=new THREE.WebGLRenderer({antialias:!0}):b.object3D.renderer=new THREE.CanvasRenderer,b.object3D.renderer.setSize(h,i),$(b.object3D.renderer.domElement).attr("id","threeJScanvas"),b.baseLayer.append(b.object3D.renderer.domElement),THREEx.WindowResize(b.object3D.renderer,b.object3D.camera),THREEx.FullScreen.bindKey({charCode:"m".charCodeAt(0)}),d=new THREE.OrbitControls(b.object3D.camera,b.object3D.renderer.domElement),b.object3D.light=new THREE.PointLight(16777215),b.object3D.light.position.set(100,250,100),b.object3D.scene.add(b.object3D.light),b.get3DscreenShot=function(){b.render3D(),$("#3dScreenshot").attr("src",b.object3D.renderer.domElement.toDataURL())};var n=!1;b.render3D=function(){if(d.update(),b.object3D.renderer.render(b.object3D.scene,b.object3D.camera),!n){var a=!1;for(var c in b)"image"==b[c].target&&(a=!0);a||(b.startScreen(),n=!0)}}}},ScreenController.prototype.addAudio=function(a){var b=this,c={id:"audio_1",func:"addAudio",parentComponent:"audio",cls:"audio_plugin",x:0,y:0,opacity:1,src:"http://www.w3schools.com/tags/horse.mp3",autoplay:1,repeat:1,startTime:"0",stopTime:"0"};if(a.parentComponent="audio",a.cls="audio_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="audio";var d=$('<audio controls><source src="'+c.src+'" type="audio/mpeg"></audio>');d.attr("data",a.id),d.attr("id",a.id),d.addClass("audio_plugin"),d.css({opacity:c.opacity});for(var e=0;e<mediaEvents.length;e++)$(d).off(mediaEvents[e]).on(mediaEvents[e],function(a){"ended"==a.type&&0==c.repeat&&$(d)[0].play(),b[c.id].listener&&b[c.id].listener({event:a.type,time:this.currentTime})});b[a.id].read=function(a,b){var e;switch(a){case"domElem":e=d;break;case"config":e=c;break;case"css":e=css(d);break;case"time":e=$(d)[0].currentTime}return e},b[a.id].write=function(a,b){switch(a){case"show":d.show();break;case"hide":d.hide();break;case"css":$(d).css(b);break;case"play":$(d)[0].play(),b&&($(d)[0].currentTime=Number(b));break;case"pause":$(d)[0].pause();break;case"time":$(d)[0].currentTime=b;break;case"stop":$(d)[0].currentTime=.1}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addBreadBoard=function(a){function l(){for(var a=0,b=0;b<d.height;b+=50)if(0!=b){j[a]=new Array;for(var f=0;f<d.width;f+=50)0!=f&&(e.beginPath(),e.arc(f,b,8,0,2*Math.PI,!1),e.fillStyle=c.dotColor,e.fill(),e.lineWidth=1,e.strokeStyle=c.dotColor,e.stroke(),j[a].push({x:f,y:b}));a++}k=e.getImageData(0,0,d.width,d.height),p()}function m(a,b){a-=$(d).offset().left,b-=$(d).offset().top;for(var c,e,f=0;f<j.length;f++)for(var g=0;g<j[f].length;g++){var h=a>=j[f][g].x-8&&a<=j[f][g].x+8,i=b>=j[f][g].y-8&&b<=j[f][g].y+8;h&&i&&(c=j[f][g].x,e=j[f][g].y)}return{x:c,y:e}}function n(a){var b=a.x,d=a.y;e.beginPath(),e.arc(b,d,8,0,2*Math.PI,!1),e.fillStyle=c.jointColor,e.fill(),e.lineWidth=1,e.strokeStyle=c.wireColor,e.stroke()}function o(a,b){if(d.width=d.width,e.putImageData(k,0,0),p(),""!=i&&n(r(i)),""!=h){var c=r(h);n(c),a-=$(d).offset().left,b-=$(d).offset().top,e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(a,b),e.lineWidth=5,e.stroke()}}function p(){if(""!=c.connectArr){d.width=d.width,e.putImageData(k,0,0);for(var a=c.connectArr.split(","),b=0;b<a.length;b++)if(null!=a[b]){var f=r(a[b].split("|")[0]),g=r(a[b].split("|")[1]);e.beginPath(),e.moveTo(f.x,f.y),e.lineTo(g.x,g.y),e.lineWidth=5,e.strokeStyle=c.wireColor,e.stroke(),n(f),n(g)}}}function r(a){var b=Number(a.split("-")[0])-1,c=Number(a.split("-")[1])-1;return j[b][c]}function s(a){for(var b="",c=0;c<j.length;c++)for(var d=0;d<j[c].length;d++)a.x==j[c][d].x&&a.y==j[c][d].y&&(b+=c+1+"-"+(d+1));return b}function t(a){for(var b="",d=c.connectArr.split(","),e=0;e<d.length;e++){var f=d[e].split("|")[0],g=d[e].split("|")[1];""!=f&&""!=g&&f!=g&&(b+=f+"|"+g+",")}return b=b.substring(0,b.length-1)}var b=this,c={id:"breadBoard_1",func:"addBreadBoard",parentComponent:"breadboard",cls:"breadBoard_plugin",x:0,y:0,width:200,height:200,opacity:.8,bgColor:"#c0c0c0",wireColor:"#000000",dotColor:"#cccccc",jointColor:"#ff0000",eraser:1,connectArr:"",startTime:"0",stopTime:"0"};if(a.parentComponent="breadboard",a.cls="breadBoard_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="breadboard";var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.width,d.height=c.height,b[a.id].canvas=d,b[a.id].context=e,b[a.id].obj=$(d),$(d).attr("data",a.id),$(d).attr("id",a.id),$(d).addClass("breadBoard_plugin");var f=c.bgColor;"1"==c.bgShow&&(f="transparent"),$(d).css({background:f,opacity:c.opacity});var g=document.createElement("div");$(g).attr("class","breadBoardEraser"),b[a.id].elem.append(g),$(g).hide(),0==c.eraser&&$(g).show(),$(g).draggable({revert:!0,containment:"parent"}),$(g).css({position:"absolute",right:"5px","top:":"5px"}),$(g).bind("mouseup touchend",function(a){for(var g,d=b.getPageX(a),e=b.getPageY(a),f=m(d,e),h=!1,i=c.connectArr.split(","),j=0;j<i.length;j++){var k=r(i[j].split("|")[0]),l=r(i[j].split("|")[1]);k.x==f.x&&k.y==f.y&&(h=!0,g=j),l.x==f.x&&l.y==f.y&&(h=!0,g=j)}if(h){for(var n="",j=0;j<i.length;j++)j!=g&&(n+=i[j]+",");n=n.substring(0,n.length-1),c.connectArr="",c.connectArr=n,window.parent.connectInterface(c)}});var h="",i="";""!=c.connectArr&&(c.connectArr=t(c.connectArr));var j=new Array;l();var k,q=!1;$(d).bind("mousedown touchstart",function(c){q=!0;var d=b.getPageX(c),e=b.getPageY(c);h=m(d,e),n(h),h=s(h),b[a.id].mousedown&&b[a.id].mousedown(d,e)}),$(d).bind("mouseup touchend",function(d){var e=b.getPageX(d),f=b.getPageY(d);i=m(e,f),i.x&&i.y&&(n(i),i=s(i),""==c.connectArr?c.connectArr+=h+"|"+i:c.connectArr+=","+h+"|"+i,""!=h&&""!=i&&window.parent.connectInterface(c)),c.connectArr=t(c.connectArr),p(),q=!1,i="",h="",b[a.id].mouseup&&b[a.id].mouseup(e,f)}),$(d).bind("mousemove touchmove",function(c){var d=b.getPageX(c),e=b.getPageY(c);q&&o(d,e),b[a.id].mousemove&&b[a.id].mousemove(d,e)}),b[a.id].read=function(a,b){var e;switch(a){case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=d.width;break;case"height":e=d.height;break;case"connections":e=c.connectArr;break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"hide":$(d).hide();break;case"connections":c.connectArr=t(b);break;case"css":$(d).css(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addButton=function(a){function g(){f.removeClass("buttonClicked")}var b=this,c={id:"btn_1",func:"addButton",parentComponent:"button",cls:"button_plugin",x:0,y:0,opacity:1,value:"Click me",fontSize:24,theme:1,color:"#ffffff",bgColor:"#286090",bgShow:1,disable:"1",glyphicon:1,glyphiconId:"",startTime:"0",stopTime:"0"};if(a.parentComponent="button",a.cls="button_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="button";var d="",e=0;0==c.glyphicon&&(d='<span class="glyphicon '+c.glyphiconId+'" aria-hidden="true"></span>',e=15),""==c.value&&(e=0);var f=$('<button type="button" class="btn '+btnThemes[c.theme]+' btn-lg">'+d+'<span style="margin-left:'+e+'px">'+c.value+"</span></button>");b[a.id].obj=f,f.attr("data",a.id),f.attr("id",a.id),f.addClass("button_plugin"),f.addClass("buttonNormal"),f.css({"font-size":c.fontSize+"px",opacity:c.opacity,color:c.color}),0==c.bgShow&&f.css({background:c.bgColor}),$(document).bind("mouseup touchstart",g),addMouseEvents(c,f,b),b[c.id].eventDetected=function(a){"mousedown"==a.event&&f.addClass("buttonClicked"),"mouseenter"==a.event&&console.log("mouseenter = "),"mouseout"==a.event&&console.log("mouseenter = "),b[c.id].listener&&b[c.id].listener(a)},b[a.id].read=function(a,b){var d;switch(a){case"domElem":d=f;break;case"config":d=c;break;case"left":d=f.offset().left;break;case"top":d=f.offset().top;break;case"width":d=f.width();break;case"height":d=f.height();break;case"css":d=css(f)}return d},b[a.id].write=function(a,b){switch(console.log("button write"),a){case"value":f.html(b);break;case"disable":f.attr("disabled","disabled");break;case"enable":f.removeAttr("disabled");break;case"show":f.show();break;case"hide":f.hide();break;case"css":f.css(b)}},"0"==c.disable&&b[a.id].write("disable",!0),b.updateElementHolder(c,f),b.closeElementHolder(c)}},ScreenController.prototype.addCanvas=function(a){function j(){console.log("drawObjects"),console.log("canvasLayers = ",g),q(),s()}function k(a,b){return{x:a-$(d).offset().left,y:b-$(d).offset().top}}function l(a){var c={x:0,y:0,r:10,color:"#ff0000",borderColor:"#ff0000",borderWidth:3,background:"transparent"};b.updateObj(c,a),e.save(),e.beginPath(),e.arc(c.x,c.y,c.r,0,2*Math.PI,!1),e.fillStyle=c.background,e.fill(),e.strokeStyle=c.borderColor,e.lineWidth=c.borderWidth,e.stroke(),e.restore()}function m(a){var c={width:1,color:"#000000"};b.updateObj(c,a);var d=a.arr;e.save(),e.beginPath(),e.moveTo(d[0].x,d[0].y);for(var f=1;f<d.length;f++)e.lineTo(d[f].x,d[f].y);e.lineWidth=c.width,e.strokeStyle=c.color,e.stroke(),e.restore()}function n(a){console.log("writeArc"),console.log("obj == ",a);var c={x:200,y:200,r:75,startAngle:0,endAngle:180,color:"#000000",width:5,counterClockwise:!1};b.updateObj(c,a);var d=c.startAngle/180*Math.PI,f=c.endAngle/180*Math.PI;e.beginPath(),e.arc(c.x,c.y,c.r,d,f,c.counterClockwise),e.lineWidth=c.width,e.strokeStyle=c.color,e.stroke()}function o(a){var c={x:0,y:0,text:"sample text",fontSize:"40pt",fontFamily:"Calibri",fontStyle:"italic",textBaseline:"top",color:"#000000"};b.updateObj(c,a),e.font=c.fontStyle+" "+c.fontSize+" "+c.fontFamily,e.fillStyle=c.color,e.textBaseline=c.textBaseline,e.fillText(c.text,c.x,c.y)}function q(){console.log("drawRectangles = ");for(var a=0;a<g.length;a++)for(var b in g[a])t(g[a][b])}function s(){for(var a in r)o(r[a])}function t(a){var c={x:0,y:0,w:100,h:100,background:"white",borderColor:"black",borderWidth:1,color:"#000000"};b.updateObj(c,a),e.beginPath(),e.rect(c.x,c.y,c.w,c.h),e.fillStyle=c.background,e.fill(),e.lineWidth=c.borderWidth,e.strokeStyle=c.borderWidth,e.stroke()}function u(c,f){var g=-c.width/2,h=-c.height/2;b[a.id].clear(),e.save(),e.translate(d.width/2,d.height/2),e.rotate(f*(Math.PI/180)),e.drawImage(c,g,h),e.restore()}var b=this,c={id:"cnv_1",func:"addCanvas",parentComponent:"canvas",cls:"canvas_plugin",x:0,y:0,width:200,height:200,opacity:1,bgColor:"#ffffff",bgShow:0,drag:1,dragRevert:1,dragContainment:[0,0,1024,786],drop:1,opacity:1,startTime:"0",stopTime:"0"};if(a.parentComponent="canvas",a.cls="canvas_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="canvas";var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.width,d.height=c.height,b[a.id].canvas=d,b[a.id].context=e,b[a.id].obj=$(d),$(d).attr("data",a.id),$(d).attr("id",a.id),$(d).addClass("canvas_plugin");var f=c.bgColor;"1"==c.bgShow&&(f="transparent"),$(d).css({background:f,opacity:c.opacity});var g=new Array;b[c.id].eventDetected=function(a){var d=b[c.id].read("relativeXY",{x:a.data.x,y:a.data.y});a.relativeX=d.x,a.relativeY=d.y,"mousedown"==a.event,b[c.id].listener&&b[c.id].listener(a)},addMouseEvents(c,d,b),addDragEvent(c,d,b),addDropEvent(c,d,b),b[a.id].read=function(a,b){var e;switch(a){case"relativeXY":e=k(b.x,b.y);break;case"image":e=d.toDataURL();break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"domElem":e=d;break;case"config":e=c;break;case"css":e=css(d)}return e};b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"hide":$(d).hide();break;case"line":m(b);break;case"arc":n(b);break;case"circle":l(b);break;case"rectangle":t(b);break;case"image":u(b.image,b.degree);break;case"text":o(b);break;case"clear":d.width=d.width;break;case"css":$(d).css(b)}},b[a.id].clear=function(){d.width=d.width},b[a.id].render=function(){j()};var r=(new Object,new Object);b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addCheckBox=function(a){function i(){e.width=e.width,h?j(g):k(g)}function j(a){a.beginPath(),a.rect(.1*c.checkBoxWidth,.1*c.checkBoxWidth,.8*c.checkBoxWidth,.8*c.checkBoxWidth),a.lineWidth=.1*c.checkBoxWidth,a.strokeStyle=c.bgColor,a.stroke(),a.beginPath(),a.moveTo(.2*c.checkBoxWidth,.5*c.checkBoxWidth),a.lineTo(.4*c.checkBoxWidth,.7*c.checkBoxWidth),a.lineTo(c.checkBoxWidth,0),a.stroke()}function k(a){a.beginPath(),a.rect(.1*c.checkBoxWidth,.1*c.checkBoxWidth,.8*c.checkBoxWidth,.8*c.checkBoxWidth),a.lineWidth=.1*c.checkBoxWidth,a.strokeStyle=c.bgColor,a.stroke()}var b=this,c={id:"checkbox_1",func:"addCheckBox",parentComponent:"checkbox",cls:"checkbox_plugin",x:0,y:0,opacity:1,color:"#000000",bgColor:"#000000",value:"checkbox",fontSize:34,checkBoxWidth:50,check:1,startTime:"0",stopTime:"0"};if(a.parentComponent="checkbox",a.cls="checkbox_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="checkbox";var d=$('<div class="checkBoxHolder" style="display:table"></div>');d.attr("data",a.id),d.attr("id",a.id),b[a.id].obj=d,d.addClass("checkbox_plugin"),d.css({"font-size":c.fontSize+"px",color:c.color,cursor:"pointer"});var e=document.createElement("canvas"),f=document.createElement("span");$(f).css({display:"table-cell"}),$(f).append(e),d.append(f),$(e).css("float","left"),$(e).css("opacity",c.opacity),d.append("<span style='display:table-cell;vertical-align: middle;'><div style='margin-left:10px;'>"+c.value+"</div></span>");var g=e.getContext("2d"),h=!1;e.width=c.checkBoxWidth,e.height=c.checkBoxWidth,i(),d.bind("click",function(c){h=!h,i(),b.audio.playEffect("click"),b[a.id].listener&&b[a.id].listener({event:"click",data:{checked:h}})}),b[a.id].read=function(a,b){var e;switch(a){case"check":e=h;break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"check":h=!0,i();break;case"hide":$(d).hide();break;case"css":$(d).css(b)}},0==c.check&&d.trigger("click"),b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addClock=function(a){function n(){var a=400,k=0,l=0,n=(180+(c.value-c.min)/(c.max-c.min)*180,a/2-10);d.width=d.width,e.translate(d.width/2,d.height/2),e.scale(f,f),e.beginPath(),e.arc(k,l,n,0,2*Math.PI,!1),e.fillStyle="black",e.fill(),e.lineWidth=3,e.strokeStyle="#ff0000",e.stroke(),e.font="bold 20px arial",e.textBaseline="middle",e.fillStyle="#ffffff";var o=getTextDimentions(c.label,"20px");e.fillText(c.label,-o.width/2,-o.height/2-30);var p=.4*n,q=p*Math.cos(h*(Math.PI/180)),r=p*Math.sin(h*(Math.PI/180));e.beginPath(),e.moveTo(k,l),e.lineTo(k+q,l+r),e.lineWidth=5,e.strokeStyle="#ffffff",e.stroke();var p=.5*n,q=p*Math.cos(i*(Math.PI/180)),r=p*Math.sin(i*(Math.PI/180));e.beginPath(),e.moveTo(k,l),e.lineTo(k+q,l+r),e.lineWidth=5,e.strokeStyle="#ffffff",e.stroke();var s=.5*n,q=s*Math.cos(j*(Math.PI/180)),r=s*Math.sin(j*(Math.PI/180));e.beginPath(),e.moveTo(k,l),e.lineTo(k+q,l+r),e.lineWidth=4,e.strokeStyle="#ff0000",e.stroke(),e.beginPath(),e.arc(k,l,20,0,2*Math.PI,!1),e.fillStyle="red",e.fill(),e.lineWidth=2,e.strokeStyle="black",e.stroke();for(var t=3,u=0;u<=360;u+=30){var v=(n-40)*Math.cos(u*(Math.PI/180)),w=(n-40)*Math.sin(u*(Math.PI/180)),x=n*Math.cos(u*(Math.PI/180)),y=n*Math.sin(u*(Math.PI/180)),z=(n-60)*Math.cos(u*(Math.PI/180)),A=(n-60)*Math.sin(u*(Math.PI/180));e.beginPath(),e.moveTo(k+v,l+w),e.lineTo(k+x,l+y),e.font="bold 18px arial",e.fillStyle="#ffffff";var o=getTextDimentions(u,"18px");180==u&&(z-=o.width/7),240==u&&(z-=o.width/3,A+=o.height/3),u>270&&(z-=o.width),270==u&&(z-=o.width/2,A+=10),300==u&&(z+=.7*o.width,A+=o.height/3),330==u&&(z+=.7*o.width,A+=o.height/3),360==u&&(z+=o.width/7),360!=u&&(t>12&&(t-=12),e.fillText(t,k+z,l+A)),e.lineWidth=2.5,e.strokeStyle="#ffffff",e.stroke(),t++}e.drawImage(g,-g.width/2,-g.height/2)}function o(){Number(k)>12&&(k=Number(k)-12),h=Number(k)/12*360-90,h+=Number(l)/60*30,i=Number(l)/60*360-90,j=Number(m)/60*360-90,n()}var b=this,c={id:"clock_1",func:"addClock",parentComponent:"analogClock",cls:"clock_plugin",x:0,y:0,width:200,height:200,opacity:1,label:"Scortual",startTime:"0",stopTime:"0"};if(a.parentComponent="analogClock",a.cls="clock_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="clock";var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.width,d.height=c.height,b[a.id].canvas=d,b[a.id].context=e,b[a.id].obj=$(d),$(d).attr("data",a.id),$(d).attr("id",a.id),$(d).addClass("clock_plugin"),$(d).css({opacity:c.opacity});var f=d.width/400,g=new Image;g.src="images/meterTrans.png",g.onload=function(){n()};var k,l,m,h=30,i=50,j=180;b[a.id].read=function(a,b){var e;switch(a){case"time":e={h:k,m:l,s:m};break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=d.width;break;case"height":e=d.height;break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"hide":$(d).hide();break;case"time":k=b.h,l=b.m,m=b.s,o();break;case"css":$(d).css(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addDiv=function(a){function f(){$(".divChild").css("opacity",1)}function h(a){$(d).append(a),$(a).attr("class","divChild"),$(a).bind("mousedown",function(){g=$(this).attr("data-name"),$(this).css("opacity",.8)})}var b=this,c={id:"div_1",func:"addDiv",parentComponent:"div",cls:"div_plugin",x:0,y:0,width:200,height:200,opacity:1,color:"#000000",bgColor:"#ffefd5",bgShow:0,bgImage:"",drag:0,dragRevert:0,dragContainment:"0,0,1024,786",drop:0,rotateX:"0",rotateY:"0",rotateZ:"0",shadowX:1,shadowY:1,shadowSpread:1,shadowBlur:1,shadowColor:"#666666",cursor:0,borderRadius:"0",startTime:"0",stopTime:"0"};if(a.parentComponent="div",a.cls="div_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="div";var d=$("<div></div>"),e=c.bgColor;"1"==c.bgShow&&(e="transparent"),d.css({position:"relative",overflow:"hidden",width:c.width+"px",height:c.height+"px",cursor:cursorArr[c.cursor],opacity:c.opacity,color:c.color,"border-radius":c.borderRadius+"px","background-color":e,"background-image":"url("+c.bgImage+")",transform:"rotateX("+c.rotateX+"deg) rotateY("+c.rotateY+"deg) rotateZ("+c.rotateZ+"deg)",perspective:c.perspective+"px","box-shadow":c.shadowX+"px "+c.shadowY+"px "+c.shadowBlur+"px "+c.shadowSpread+"px "+c.shadowColor}),b[a.id].obj=d,d.attr("data",a.id),d.attr("id",a.id),d.addClass("div_plugin"),addMouseEvents(c,d,b),addDragEvent(c,d,b),addDropEvent(c,d,b),b[c.id].eventDetected=function(a){$(".divChild").length>0&&(a.child=g),b[c.id].listener&&b[c.id].listener(a)},$(document).bind("mouseup",f);var g;b[a.id].read=function(a,b){var e;switch(a){case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"hide":$(d).hide();break;case"css":d.css(b);break;case"child":h(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addGraph=function(a){function m(c){var d={color:"#ff0000",reset:!0,showArrow:!1,lineWidth:5};b.updateObj(d,c),b[a.id].graph.drawLines({data:c.arr,id:c.id,color:d.color,reset:d.reset,lineWidth:d.lineWidth,showArrow:d.showArrow})}function n(c){var d={color:"#ff0000",reset:!0,showArrow:!1,lineWidth:5,pixel:!1};if(b.updateObj(d,c),d.pixel){var e=b[a.id].graph.getPixelToPoint(Number(c.x),Number(c.y),!0);d.x=e.x,d.y=e.y}b[a.id].graph.drawPoints({x:d.x,y:d.y,id:d.id,color:d.color})}function o(c){var d=document.getElementById("canvas_image_graphComp");c.reset&&(d.width=d.width);var e=d.getContext("2d"),f=b[a.id].graph.getPixelVal(c.x,c.y);if(c.image.type)var g=c.image.read("domElem");else var g=c.image;e.drawImage(g,f.x-g.width/2,f.y-g.height/2)}function p(){var a=document.getElementById("canvas_image_graphComp");a.getContext("2d");a.width=a.width}function q(){b[a.id].graph.cleanAll()}var b=this,c={id:"graph_1",func:"addGraph",parentComponent:"graph",cls:"graph_plugin",x:0,y:0,width:531,height:496,opacity:1,bgColor:"#628fb5",bgShow:0,quadrants:0,gridColor:"#808080",gridLineWidth:2,gridNumberColor:"#000000",gridShow:0,gridXunits:"10",gridXunitInterval:"2",gridYunits:"10",gridYunitInterval:"2",gridFontSize:18,gridFontStyle:0,axisColor:"#ff0000",axisWidth:4,axisLabelX:"X",axisLabelY:"Y",axisLabelXSuffix:"",axisLabelYSuffix:"",axisFontSize:25,pan:0,pointSize:10,lineWidth:10,startTime:"0",stopTime:"0"};if(a.parentComponent="graph",a.cls="graph_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="graph",b[a.id].elem.css({width:globalResizeCalc(Number(c.width))+"px",height:globalResizeCalc(Number(c.height))+"px"});var d="center",e="center";"0"==c.quadrants&&(d="center",e="center"),"1"==c.quadrants&&(d="left",e="bottom"),"2"==c.quadrants&&(d="left",e="center"),"3"==c.quadrants&&(d="center",e="top"),"4"==c.quadrants&&(d="center",e="bottom");var f=!0,g=!0;"0"==Number(c.pan)?(f=!0,g=!0):(f=!1,g=!1);var h=c.gridColor;1==Number(c.gridShow)&&(h="transparent");var i="normal";0==c.gridFontStyle&&(i="normal"),1==c.gridFontStyle&&(i="bold"),2==c.gridFontStyle&&(i="italic");var j=c.width/2/c.gridXunits,k=c.height/2/c.gridYunits;1==c.bgShow&&(c.bgColor="transparent"),console.log("p.bgShow = ",c.bgShow);var l=document.createElement("div");$(l).css("opacity",c.opacity),b[a.id].graph=new cartesian_graph,b[a.id].graphObj={id:"graphComp",target:$(l),bgColor:c.bgColor,axisColor:c.axisColor,gridBgColor:"transparent",x:0,y:0,arrows:!0,labelX:"<i>"+c.axisLabelX+"</i>",labelY:"<i>"+c.axisLabelY+"</i>",width:Number(c.width),height:Number(c.height),gridLineWidth:c.gridLineWidth,originX:d,originY:e,unitX:j,unitY:k,labelIntervalX:Number(c.gridXunitInterval),labelIntervalY:Number(c.gridYunitInterval),intervalX:Number(c.gridXunitInterval),intervalY:Number(c.gridYunitInterval),gridColor:h,pointSize:Number(c.pointSize),panX:f,panY:g,labelFontColor:c.gridNumberColor,axisLabelXSuffix:c.axisLabelXSuffix,axisLabelYSuffix:c.axisLabelYSuffix,axisWidth:Number(c.axisWidth),axisgridLabelFontSize:Number(c.axisFontSize),toFixedVal:2,labelFontFamily:"arial",gridLabelFontSize:Number(c.gridFontSize),gridLabelFontStyle:i},b[a.id].graph.init(b[a.id].graphObj),$(l).addClass("graph_plugin"),$(l).attr("data",a.id),b[a.id].read=function(d,e){var f;switch(d){case"pixelValue":f=b[a.id].graph.getPixelVal(Number(e.x),Number(e.y),!0);break;case"pointValue":f=b[a.id].graph.getPointVal(Number(e.x),Number(e.y),!0);break;case"domElem":f=l;break;case"config":f=c;break;case"left":f=$(l).offset().left;break;case"top":f=$(l).offset().top;break;case"width":f=$(l).width();break;case"height":f=$(l).height();break;case"css":f=css(l)}return f},b[a.id].write=function(a,b){switch(a){case"show":$(l).show();break;case"hide":$(l).hide();break;case"line":m(b);break;case"point":n(b);break;case"image":o(b);break;case"clearImages":p();break;case"clearGraph":q();break;case"css":$(l).css(b)}},b.updateElementHolder(c,l),b.closeElementHolder(c)}},ScreenController.prototype.addImage=function(a){function h(a,b){switch(a){case"grayScale":b=i(b);break;case"negative":b=j(b);break;case"bright":b=k(b);break;case"threshold":b=l(b);break;case"sharp":b=m(b);break;case"blur":b=n(b)}f.putImageData(b,0,0)}function i(a){for(var b=a.data,c=0;c<b.length;c+=4){var d=.34*b[c]+.5*b[c+1]+.16*b[c+2];b[c]=d,b[c+1]=d,b[c+2]=d}return a}function j(a){for(var b=a.data,c=0;c<b.length;c+=4)b[c]=255-b[c],b[c+1]=255-b[c+1],b[c+2]=255-b[c+2];return a}function k(a){for(var b=2,c=a.data,d=0;d<c.length;d+=4){.34*c[d]+.5*c[d+1]+.16*c[d+2];c[d]=c[d]*b,c[d+1]=c[d+1]*b,c[d+2]=c[d+2]*b}return a}function l(a){for(var d,b=a.data,c=70,e=0;e<b.length;e+=4){var f=b[e],g=b[e+1],h=b[e+2],d=.2126*f+.7152*g+.0722*h>=c?255:0;b[e]=b[e+1]=b[e+2]=d}return a}function m(a){var d=[0,-1,0,-1,5,-1,0,-1,0],e=a.data;length=e.length;for(var f=a.data,g=a.width,h=a.height,i=g,j=h,k=Math.round(Math.sqrt(d.length)),l=Math.floor(k/2),m=0,n=0;n<j;n++)for(var o=0;o<i;o++){for(var p=n,q=o,r=4*(n*i+o),s=0,t=0,u=0,v=0,w=0;w<k;w++)for(var x=0;x<k;x++){var y=p+w-l,z=q+x-l;if(y>=0&&y<h&&z>=0&&z<g){var A=4*(y*g+z),B=d[w*k+x];s+=f[A]*B,t+=f[A+1]*B,u+=f[A+2]*B,v+=f[A+3]*B}}e[r]=s,e[r+1]=t,e[r+2]=u,e[r+3]=v+m*(255-v)}return a}function n(a){var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=a.data;length=e.length;for(var f=a.data,g=a.width,h=a.height,i=g,j=h,k=Math.round(Math.sqrt(d.length)),l=Math.floor(k/2),m=0,n=0;n<j;n++)for(var o=0;o<i;o++){for(var p=n,q=o,r=4*(n*i+o),s=0,t=0,u=0,v=0,w=0;w<k;w++)for(var x=0;x<k;x++){var y=p+w-l,z=q+x-l;if(y>=0&&y<h&&z>=0&&z<g){var A=4*(y*g+z),B=d[w*k+x];s+=f[A]*B,t+=f[A+1]*B,u+=f[A+2]*B,v+=f[A+3]*B}}e[r]=s,e[r+1]=t,e[r+2]=u,e[r+3]=v+m*(255-v)}return a}function o(a){e.width=e.width;var b=-d.width/2,c=-d.height/2;f.save(),f.translate(e.width/2,e.height/2),f.rotate(a*(Math.PI/180)),f.drawImage(d,b,c),f.restore()}var b=this,c={id:"img_1",func:"addImage",parentComponent:"image",cls:"image_plugin",x:0,y:0,width:"auto",height:"auto",
opacity:1,src:"http://i.imgur.com/L3Gvb4M.jpg",bgStrech:1,filter:0,show:0,drag:1,dragRevert:1,dragContainment:[0,0,1024,786],drop:1,rotate:"0",scale:"1",cursor:0,startTime:"0",stopTime:"0"};if(a.parentComponent="image",a.cls="image_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="image";var d=new Image;d.crossOrigin="Anonymous",b.globalImageArr.push(c.src),d.src=c.src;var e=document.createElement("canvas"),f=e.getContext("2d");e.width=c.width,e.height=c.height,$(e).attr("name",a.id),$(e).attr("data",a.id),$(e).attr("id",a.id),$(e).addClass("image_plugin");var g="block";"1"==c.show&&(g="none"),$(e).css({display:g,opacity:c.opacity,cursor:cursorArr[c.cursor]}),f.fillStyle="#ffffff",f.fill(),f.fillRect(0,0,e.width,e.height),f.font="20px Verdana",f.fillStyle="#000000",f.fillText("Loading image ....",20,e.height/2),d.onload=function(){e.width=e.width,"auto"==c.width&&(e.width=this.width),"auto"==c.height&&(e.height=this.height),f.translate(e.width/2,e.height/2),f.scale(c.scale,c.scale),f.rotate(c.rotate*(Math.PI/180));var d;d="auto"==c.width?this.width:c.width;var g;if(g="auto"==c.height?this.height:c.height,0==c.bgStrech?f.drawImage(this,-d/2,-g/2,d,g):f.drawImage(this,-this.width/2,-this.height/2),0!=c.filter){var i=f.getImageData(0,0,d,g);h(imageFilterArr[c.filter],i)}b[a.id].elem.css("width",d+"px"),b[a.id].elem.css("height",g+"px"),b[a.id].obj=$(e),b[a.id].listener&&b[a.id].listener({event:"loaded",data:this})},addMouseEvents(c,e,b),addDragEvent(c,e,b),addDropEvent(c,e,b),b[c.id].eventDetected=function(a){b[c.id].listener&&b[c.id].listener(a)},b[a.id].read=function(a,b){var g;switch(a){case"imageDataURL":g=e.toDataURL();break;case"imageData":g=f.getImageData(0,0,d.width,d.height);break;case"left":g=$(e).offset().left;break;case"top":g=$(e).offset().top;break;case"width":g=e.width;break;case"height":g=e.height;break;case"domElem":g=e;break;case"config":g=c;break;case"css":g=css(e)}return g},b[a.id].write=function(a,b){switch(a){case"show":$(e).show();break;case"hide":$(e).hide();break;case"rotate":o(b);break;case"css":$(e).css(b)}},b.updateElementHolder(c,e),b.closeElementHolder(c)}},ScreenController.prototype.addLed=function(a){function i(){f.width=f.width,h?j(g):k(g)}function j(){d=!0,f.width=f.width,g.beginPath(),g.arc(f.width/2,f.height/2,.3*f.width,0,2*Math.PI,!1),g.fillStyle=c.bgColor,g.fill(),g.lineWidth=.1*c.width,g.strokeStyle=c.bgColor,g.stroke(),g.beginPath(),g.arc(f.width/2,f.height/2,.4*f.width,0,2*Math.PI,!1),g.lineWidth=.1*c.width,g.strokeStyle=c.bgColor,g.stroke()}function k(){d=!1,f.width=f.width,g.beginPath(),g.arc(f.width/2,f.height/2,.4*f.width,0,2*Math.PI,!1),g.lineWidth=.1*c.width,g.strokeStyle=c.bgColor,g.stroke()}var b=this,c={id:"led_1",func:"addLed",parentComponent:"led",cls:"led_plugin",x:0,y:0,width:50,opacity:1,bgColor:"#00ff00",startTime:"0",stopTime:"0"};a.parentComponent="led",a.cls="led_plugin";var d=!1;if(b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="led";var e=$('<div class="ledHolder"></div>');e.attr("data",a.id),e.attr("id",a.id),b[a.id].obj=e,e.addClass("led_plugin");var f=document.createElement("canvas");e.append(f),$(f).css("float","left"),$(f).css("opacity",c.opacity);var g=f.getContext("2d"),h=!1;f.width=c.width,f.height=c.width,i(),b[a.id].read=function(a,b){var e;switch(a){case"status":e=d;break;case"domElem":e=f;break;case"config":e=c;break;case"left":e=$(f).offset().left;break;case"top":e=$(f).offset().top;break;case"width":e=$(f).width();break;case"height":e=$(f).height();break;case"css":e=css(f)}return e},b[a.id].write=function(a,b){switch(a){case"show":$(f).show();break;case"hide":$(f).hide();break;case"css":$(f).css(b);break;case"blink":j(),setTimeout(function(){k()},100);break;case"on":j();break;case"off":k()}},b.updateElementHolder(c,e),b.closeElementHolder(c)}},ScreenController.prototype.addMeter=function(a){function h(){var a=400,h=0,i=0;c.max=Number(c.max),c.min=Number(c.min),c.value=Number(c.value);var j=180+(c.value-c.min)/(c.max-c.min)*180,k=j,l=a/2-10,m=.4*l;d.width=d.width,e.translate(d.width/2,d.height/2),e.scale(f,f),e.beginPath(),e.arc(h,i,l,0,2*Math.PI,!1),e.fillStyle="black",e.fill(),e.lineWidth=3,e.strokeStyle="#ff0000",e.stroke(),e.beginPath(),e.arc(h,i,20,0,2*Math.PI,!1),e.fillStyle="red",e.fill(),e.lineWidth=2,e.strokeStyle="black",e.stroke(),e.font="bold 20px arial",e.textBaseline="middle",e.fillStyle="#ffffff";var n=getTextDimentions(c.label,"20px");e.fillText(c.label,-n.width/2,-n.height/2-30);var o=m*Math.cos(k*(Math.PI/180)),p=m*Math.sin(k*(Math.PI/180));e.beginPath(),e.moveTo(h,i),e.lineTo(h+o,i+p),e.lineWidth=4,e.strokeStyle="#ff0000",e.stroke();var q=c.value+""+c.suffix;e.font="italic 50px arial";var n=getTextDimentions(q,"50px");e.fillStyle="#0f0",e.fillText(q,-n.width/2,l/2);for(var r=180;r<=360;r+=30){var s=(l-40)*Math.cos(r*(Math.PI/180)),t=(l-40)*Math.sin(r*(Math.PI/180)),u=l*Math.cos(r*(Math.PI/180)),v=l*Math.sin(r*(Math.PI/180)),w=(l-60)*Math.cos(r*(Math.PI/180)),x=(l-60)*Math.sin(r*(Math.PI/180));e.beginPath(),e.moveTo(h+s,i+t),e.lineTo(h+u,i+v),e.font="bold 18px arial",e.fillStyle="#ffffff";var n=getTextDimentions(r,"18px");180==r&&(w-=n.width/7),240==r&&(w-=n.width/3,x+=n.height/3),r>270&&(w-=n.width),270==r&&(w-=n.width/2,x+=10),300==r&&(w+=n.width/3,x+=n.height/3),360==r&&(w+=n.width/7);var y=c.min+(r-180)/180*(c.max-c.min);y=Number(y.toFixed(2)),e.fillText(y,h+w,i+x),e.lineWidth=2.5,e.strokeStyle="#ffffff",e.stroke()}e.drawImage(g,-g.width/2,-g.height/2)}var b=this,c={id:"meter_1",func:"addMeter",parentComponent:"analogMeter",cls:"meter_plugin",x:0,y:0,width:400,height:400,opacity:1,min:"0",max:"100",value:50,suffix:"v",label:"Voltmeter",startTime:"0",stopTime:"0"};if(a.parentComponent="analogMeter",a.cls="meter_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="meter";var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.width,d.height=c.height,b[a.id].canvas=d,b[a.id].context=e,b[a.id].obj=$(d),$(d).attr("data",a.id),$(d).attr("id",a.id),$(d).addClass("meter_plugin"),$(d).css({opacity:c.opacity});var f=d.width/400,g=new Image;g.src="images/meterTrans.png",g.onload=function(){h()},b[a.id].write=function(a,b){switch(a){case"value":c.value=Number(Number(b).toFixed(2)),h();break;case"show":$(d).show();break;case"hide":$(d).hide();break;case"css":$(d).css(b)}},b[a.id].read=function(a,b){var e;switch(a){case"value":e=c.value;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=d.width;break;case"height":e=d.height;break;case"css":e=css(d)}return e},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addProtractor=function(a){var b=this,c={id:"protractor_1",func:"addProtractor",parentComponent:"protractor",cls:"protractor_plugin",x:0,y:0,width:"auto",height:"auto",opacity:.5,show:0,drag:0,dragContainment:[-500,-500,1024,786],scale:"1",startTime:"0",stopTime:"0"};if(a.parentComponent="protractor",a.cls="protractor_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="protractor";var d=new Image;d.crossOrigin="Anonymous",d.src="images/protractor_small.png";var e=document.createElement("canvas"),f=e.getContext("2d");e.width=c.width,e.height=c.height,$(e).attr("name",a.id),$(e).attr("data",a.id),$(e).attr("id",a.id),$(e).addClass("protractor_plugin");var g="block";"1"==c.show&&(g="none"),$(e).css({display:g,opacity:c.opacity}),f.fillStyle="#ffffff",f.fill(),f.fillRect(0,0,e.width,e.height),f.font="20px Verdana",f.fillStyle="#000000",f.fillText("Loading image ....",20,e.height/2),d.onload=function(){console.log("image onloaded"),"auto"==c.width&&(e.width=this.width),"auto"==c.height&&(e.height=this.height);var d;d="auto"==c.width?this.width:c.width;var g;g="auto"==c.height?this.height:c.height,f.translate(e.width/2,e.height/2),f.scale(c.scale,c.scale),f.rotate(0*(Math.PI/180)),f.beginPath(),f.arc(0,0,d/2,0,2*Math.PI,!1),f.fillStyle="#000000",f.fill(),f.stroke(),f.drawImage(this,-d/2,-g/2,d,g),b[a.id].elem.css("width",d+"px"),b[a.id].elem.css("height",g+"px"),b[a.id].obj=$(e),b[a.id].loaded&&b[a.id].loaded(this)},b[a.id].write=function(a,b){switch(a){case"show":$(e).show();break;case"hide":$(e).hide();break;case"css":$(e).css(b)}},b[a.id].read=function(a,b){var d;switch(a){case"domElem":d=e;break;case"config":d=c;break;case"left":d=$(e).offset().left;break;case"top":d=$(e).offset().top;break;case"width":d=e.width;break;case"height":d=e.height;break;case"css":d=css(e)}return d},addDragEvent(c,e,b),b.updateElementHolder(c,e),b.closeElementHolder(c)}},ScreenController.prototype.addPulseGenerator=function(a){function l(d,e){c.frame&&(k=c.frame),0==c.pulseSource?b[a.id].interval=setInterval(function(){console.log("interval"),n()},c.pulseDuration):globalAnimClassObject.start({id:d,fps:k,frame:n})}function n(){m+=1/k,o(),b[a.id].listener&&b[a.id].listener({event:"pulse",data:{time:Number(m.toFixed(2)),dt:1/k}})}function o(){var a=m.toFixed(2),b=String(a).split(".")[0],c=String(a).split(".")[1];1==b.length&&(b="0"+b),f.html(b+" : "+c+" s")}function p(d){0==c.pulseSource?clearInterval(b[a.id].interval):globalAnimClassObject.stop(d)}var b=this,c={id:"pulseGenerator_1",func:"addPulseGenerator",parentComponent:"pulseGenerator",cls:"pulseGenerator_plugin",x:0,y:10,opacity:1,frame:24,pulseSource:1,pulseDuration:"500",autoStart:1,startTime:"0",stopTime:"0"};if(a.parentComponent="pulseGenerator",a.cls="pulseGenerator_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="pulseGenerator";var d=$('<div class="pulseGenerator btn-group btn-group-lg" role="group" aria-label="btn-group btn-group-lg"></div>');d.attr("id",c.id),d.attr("data",c.id),d.addClass("pulseGenerator_plugin");var e=$('<div class="fpsDiv"></div>'),f=$('<div class="timerDiv">00:00 s</div>'),g=$('<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>'),h=$('<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-pause" aria-hidden="true"></span></button>'),i=$('<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>');e.html("FPS : "+c.frame),d.append(e),d.append(f),d.append(g),d.append(h),d.append(i),d.css({opacity:c.opacity}),d.attr("data",a.id),b[a.id].obj=d,$(g).bind("click",function(c){b[a.id].listener&&b[a.id].listener({event:"play",data:{}}),b.audio.playEffect("click"),b[a.id].write("start")}),$(h).bind("click",function(c){b[a.id].listener&&b[a.id].listener({event:"pause",data:{}}),b.audio.playEffect("click"),b[a.id].write("stop")}),$(i).bind("click",function(c){m=0,b[a.id].write("stop"),b[a.id].listener&&b[a.id].listener({event:"reset",data:{}}),b.audio.playEffect("click")});var j=!1;b[a.id].write=function(a,b){switch(a){case"show":d.show();break;case"hide":d.hide();break;case"fps":c.frame=Number(b);break;case"pulseDuration":c.pulseDuration=Number(b);break;case"start":j=!0,l(c.id,c.frame);break;case"stop":j=!1,p(c.id);break;case"css":d.css(b)}},b[a.id].read=function(a,b){var e;switch(a){case"status":e=j;break;case"fps":e=c.fps;break;case"duration":e=c.pulseDuration;break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b.updateElementHolder(c,d),b.closeElementHolder(c)}var k=c.frame,m=0;0==c.autoStart&&b[a.id].write("start")};var GlobalAnimClass=function(){function e(){var b=new Date;for(var f in a)"undefined"!=typeof a[f]&&(void 0!=a[f].delay?("undefined"==typeof a[f].oldDate||b-a[f].oldDate>=a[f].delay)&&(a[f].oldDate=b,a[f].frame?a[f].frame(f):null):void 0!=a[f].fps&&("undefined"==typeof a[f].oldDate||b-a[f].oldDate>=1e3/a[f].fps)&&(a[f].oldDate=b,a[f].frame?a[f].frame(f):null));c&&(d=requestAnimationFrame(e))}function f(a){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b}var d,a=new Object,c=!1;this.start=function(b){b.id&&(a[b.id]=b,b.immediate||(a[b.id].oldDate=new Date),a[b.id].start?a[b.id].start():null),c||(c=!0,e())},this.stop=function(b){b&&a[b]&&(a[b].stop?a[b].stop():null,void 0!=a[b]?delete a[b]:null),0==f(a)&&(c=!1,cancelAnimationFrame(d))},this.setFps=function(b,c){b&&a[b]&&(a[b].fps=c)},function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}()},globalAnimClassObject=new GlobalAnimClass;ScreenController.prototype.addRadioBtn=function(a){function l(){for(var c=$(this).parent().find(".radioOptions"),d=0;d<c.length;d++)$(c[d]).attr("pick","false");$(this).attr("pick","true"),p(),b.audio.playEffect("click"),b[a.id].listener&&b[a.id].listener({event:"click",data:o()})}function m(a){a.beginPath(),a.arc(h.width/2,h.height/2,.2*h.width,0,2*Math.PI,!1),a.fillStyle=c.bgColor,a.fill(),a.lineWidth=.1*c.radioWidth,a.strokeStyle=c.bgColor,a.stroke(),a.beginPath(),a.arc(h.width/2,h.height/2,.4*h.width,0,2*Math.PI,!1),a.lineWidth=.1*c.radioWidth,a.strokeStyle=c.bgColor,a.stroke()}function n(a){a.beginPath(),a.arc(h.width/2,h.height/2,.4*h.width,0,2*Math.PI,!1),a.lineWidth=.1*c.radioWidth,a.strokeStyle=c.bgColor,a.stroke()}function o(){for(var a=new Object,b=d.find(".radioOptions"),c=0;c<b.length;c++)"true"==$(b[c]).attr("pick")&&(a.index=c,a.value=f[c]);return a}function p(){for(var a=d.find(".radioOptions"),b=0;b<a.length;b++){var c=$(a[b]).find("canvas")[0],e=c.getContext("2d");c.width=c.width,"true"==$(a[b]).attr("pick")?m(e):n(e)}}var b=this,c={id:"radioBtn_1",func:"addRadioBtn",parentComponent:"radioBtn",cls:"radioBtn_plugin",x:0,y:0,opacity:1,color:"#000000",bgColor:"#00ff00",options:"option_1,option_2,option_3,option_4",index:1,fontSize:32,radioWidth:50,startTime:"0",stopTime:"0"};if(a.parentComponent="radioBtn",a.cls="radioBtn_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="radioBtn";var d=$('<div class="radioHolder"></div>');d.attr("id",a.id),d.attr("data",a.id),b[a.id].obj=d,d.css({"font-size":c.fontSize+"px",color:"#ffffff",cursor:"pointer",opacity:c.opacity}),d.addClass("radioBtn_plugin");for(var e=new Array,f=c.options.split(","),g=0;g<f.length;g++){var h=document.createElement("canvas");h.getContext("2d");h.width=c.radioWidth,h.height=c.radioWidth,$(h).css("display","table-cell"),e[g]=document.createElement("div"),$(e[g]).attr("class","radioOptions"),$(e[g]).attr("data",g),$(e[g]).attr("pick","false"),$(e[g]).css("clear","both"),$(e[g]).css("display","table"),$(e[g]).click(l),d.append(e[g]);var j=document.createElement("div");$(j).css("display","table-cell"),$(j).css("vertical-align","middle"),$(j).css("padding","5px"),$(j).append(h),$(e[g]).append(j);var k=document.createElement("div");$(k).css("display","table-cell"),$(k).css("vertical-align","middle"),$(k).css("padding","5px"),$(k).append("<div style='margin-left:10px;color:"+c.color+";display:table-cell'>"+f[g]+"</div>"),$(e[g]).append(k)}$(e[c.index]).attr("pick","true"),p(),b[a.id].read=function(a,b){var e;switch(a){case"value":e=o().index;break;case"text":e=o().value;break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"hide":$(d).hide();break;case"css":$(d).css(b)}},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addRuler=function(a){function q(){p=!1,$(document).unbind("mousemove touchmove",s),$(document).unbind("mouseup touchend",q),d.draggable("enable")}function r(){h.width=h.width,h.width=parseInt(d.css("width")),h.height=parseInt(d.css("height")),$(h).css("background",c.bgColor),$(h).css("border","1px solid #cccccc;"),$(h).css("box-shadow","2px 2px 2px 2px #cccccc"),i.beginPath(),i.moveTo(h.width/2,0),i.lineTo(h.width/2,h.height),i.stroke();for(var a=0,e=0,f=!1,g=0;g<h.height;g++)if(i.beginPath(),i.moveTo(h.width,a),i.lineTo(h.width-20,a),i.stroke(),a+=5,e++,10==e){i.beginPath(),i.moveTo(h.width,a),i.lineTo(h.width-40,a),i.stroke(),i.save(),i.font="20px arial";var j=getTextDimentions(a,"20px");if(i.translate(h.width-60,a),i.rotate(90*(Math.PI/180)),i.fillText(a,-j.width/2,0),i.restore(),!f){if(i.save(),i.font="bold 35px arial",c.connect)var k=b[c.connect].read("config").width,l=b[c.connect].read("pixelValue",{x:k/2+h.height,y:0}),m="L = "+l.x.toFixed(2)+" units";else var m="L = "+h.height+" pixels";i.translate(h.width-120,a),i.rotate(90*(Math.PI/180)),i.fillText(m,0,0),i.restore(),f=!0}e=0}}function s(a){var c=d.offset().left,e=d.parent().offset().left,f=c-e;if(console.log("offsetDiff = ",f),p){var i,g=b.getPageX(a),h=b.getPageY(a),j=g-n,k=h-o;i=Math.abs(f)>50?j:k,console.log("diff = ",i);var l=parseFloat(d.css("height")),m=parseFloat(d.parent().css("top"));console.log("_parentTop = ",m),console.log("============"),l+=i,d.css("height",l),r(),n=g,o=h}}function v(a){var c=l.left+d.width()/2,e=l.top+d.height()/2,f=b.getPageX(a),g=b.getPageY(a),h=Math.atan2(f-c,g-e),i=h*(180/Math.PI)*-1-180;return i}var b=this,c={id:"ruler_1",func:"addRuler",parentComponent:"ruler",cls:"ruler_plugin",x:0,y:0,bgColor:"#b0e0e6",opacity:.5,dragContainment:[0,0,1024,786],connect:"",startTime:"0",stopTime:"0"};if(a.parentComponent="ruler",a.cls="ruler_plugin",b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="ruler";var d=$("<div></div>");b[a.id].obj=d,d.attr("data",a.id),d.addClass("ruler_plugin"),d.css({position:"relative",width:"150px",height:"500px",border:"1px solid #ff0000","z-index":"100","-webkit-transform":"rotate(0deg)",opacity:c.opacity});var e=$('<div class="upperHandle"></div>'),f=$('<div class="lowerHandle"></div>'),g=$('<div class="strechHandle"></div>');d.append(e),d.append(f),d.append(g),e.css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100px",opacity:"0.4"}),f.css({position:"absolute",bottom:"0px",right:"0px",width:"100%",height:"100px",opacity:"0.4"}),g.css({position:"absolute",bottom:"0px",right:"34px",width:"50%",height:"51px",background:"#000000",opacity:"0.4"});var h=document.createElement("canvas"),i=h.getContext("2d");d.append(h),r(),addDragEvent(c,d,b);var l,m=!1;e.bind("mousedown touchstart",function(a){m=!0,d.draggable("disable")}),f.bind("mousedown touchstart",function(a){m=!0,d.draggable("disable")});var n,o,p=!1;g.bind("mousedown touchstart",function(a){p=!0,n=b.getPageX(a),o=b.getPageY(a),$(document).bind("mousemove touchmove",s),$(document).bind("mouseup touchend",q),d.draggable("disable")}),g.bind("mouseout",function(a){});var t=0,u=0;d.bind("mousedown touchstart",function(c){l=b[a.id].elem.offset(),t=v(c)}),d.bind("mousemove touchmove",function(a){if(m){var b=v(a),c=b-t;t=b,u+=c,d.css("-moz-transform","rotate("+u+"deg)"),d.css("-webkit-transform","rotate("+u+"deg)"),d.css("-o-transform","rotate("+u+"deg)"),d.css("-ms-transform","rotate("+u+"deg)")}}),d.bind("mouseup touchend",function(a){m=!1,d.draggable("enable")}),d.bind("mouseout",function(a){m=!1,d.draggable("enable"),console.log()}),b[a.id].write=function(a,b){switch(a){case"show":$(d).show();break;case"hide":$(d).hide();break;case"css":$(d).css(b)}},b[a.id].read=function(a,b){var e;switch(a){case"length":e=css(d);break;case"domElem":e=d;break;case"config":e=c;break;case"left":e=$(d).offset().left;break;case"top":e=$(d).offset().top;break;case"width":e=$(d).width();break;case"height":e=$(d).height();break;case"css":e=css(d)}return e},b.updateElementHolder(c,d),b.closeElementHolder(c)}},ScreenController.prototype.addSelectBtn=function(a){function i(){for(var a=0,b=0;b<h.length;b++){var c=getTextDimentions(h[b],"38px");a<c.width&&(a=c.width)}return a+=20}function l(a){"container"==$(a.target).attr("class")&&$(g).hide()}function m(){for(var a=0;a<j.length;a++)$(j[a]).css("background",c.listBgColor)}function n(){m(),$(this).css("background",c.selectionColor)}function o(){m()}function p(){i()<c.width?$(e).css("width",c.width+"px"):$(e).css("width",i()+"px")}function q(){c.index=Number($(this).attr("data")),$(".selectOptions").removeClass("selectOptionSeleted"),$(this).addClass("selectOptionSeleted"),f.html($(this).html())}var b=this,c={id:"selectBtn_1",func:"addSelectBtn",parentComponent:"selectBtn",cls:"selectBtn_plugin",x:0,y:0,width:100,height:200,opacity:1,options:"option_1,option_2,option_3,option_4",fontSize:20,index:0,textAlign:0,color:"#000000",bgColor:"#ffffff",listBgColor:"#ffffff",listTextColor:"#000000",selectionColor:"#cccccc",startTime:"0",stopTime:"0"};a.parentComponent="selectBtn",a.cls="selectBtn_plugin";var d=["center","left","right"];if(b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="selectBtn";var e=$(document.createElement("div"));e.attr("data",a.id),e.attr("id",a.id),b[a.id].obj=e,e.addClass("selectBtn_plugin");var f=$(document.createElement("div"));e.append(f),e.css("fontSize",c.fontSize+"px"),e.css("cursor","pointer");var g=$(document.createElement("div"));$(g).addClass("selectList"),$(g).css("background",c.listBgColor),$(g).css("color",c.listTextColor),$(g).css("opacity",c.opacity),$(g).css("height",c.height+"px");var h=c.options.split(",");$(e).css("text-align",d[c.textAlign]),$(e).css("background",c.bgColor),$(e).css("color",c.color),p(),f.html(h[c.index]);for(var j=new Array,k=0;k<h.length;k++)j[k]=document.createElement("div"),$(g).append(j[k]),$(j[k]).addClass("selectOptions"),$(j[k]).bind("click",q),$(j[k]).hover(n,o),$(j[k]).attr("data",k),$(j[k]).html(h[k]);$(g).hide(),$(document).bind("click",l),$(e).click(function(){console.log("select clicked"),b.audio.playEffect("click"),p(),console.log("select list",$(g).css("display"));var a=$(window).height();console.log("windowHt = ",a);var d=$(g).parent().offset().top+$(g).parent().height()+$(g).height();console.log("$(_selectBtn).height() = ",$(e).height()),console.log("_selectLength = ",d);var f=$(e).height()+10;f=d<a?$(e).height()+2*parseFloat($(e).css("padding"))+5:-($(g).height()+2*parseFloat($(e).css("padding"))+10),$(g).css({top:f+"px",left:"0px"}),"none"==$(g).css("display")?($(g).show(),applyCustomScrollBar($(g),"dark-3","outside")):$(g).hide();for(var h=0;h<j.length;h++)$(j[h]).attr("data")==c.index?$(j[h]).addClass("selectActive"):$(j[h]).removeClass("selectActive")}),$(e).append(g),e.bind("click",function(d){b.audio.playEffect("click"),b[a.id].listener&&b[a.id].listener({event:"change",data:{index:c.index,value:h[c.index]}})}),b[a.id].read=function(a,b){var d;switch(a){case"value":d=c.index;break;case"domElem":d=e;break;case"config":d=c;break;case"left":d=$(e).offset().left;break;case"top":d=$(e).offset().top;break;case"width":d=$(e).width();break;case"height":d=$(e).height();break;case"css":d=css(e)}return d},b[a.id].write=function(a,b){switch(a){case"show":$(e).show();break;case"hide":$(e).hide();break;case"css":$(e).css(b)}},b.updateElementHolder(c,e),b.closeElementHolder(c)}},ScreenController.prototype.addSlider=function(a){function i(a){for(var d=c.connect.split(","),e=0;e<d.length;e++)b[d[e]]&&b[d[e]].write("value",a)}function j(a){i(a);var b=$(f).find(".sliderLabel"),d=getTextDimentions(a,c.fontSize+"px");b.html(a),0==c.orientation?(b.css("top",-(d.height/2)+"px"),b.css("right",-(d.width+35)+"px")):(b.css("top",-(d.height+15)+"px"),b.css("right",-(d.width/2)+"px"))}var b=this,c={id:"slider_1",func:"addSlider",parentComponent:"slider",cls:"slider_plugin",x:0,y:10,width:310,height:"auto",opacity:1,min:0,max:100,step:1,value:0,orientation:0,color:"#000000",showLabel:1,fontSize:32,animate:0,disable:1,connect:"",startTime:"0",stopTime:"0"};a.parentComponent="slider",a.cls="slider_plugin",b.updateObjKeys(c,a);var d=["slow","fast"],e=[!0,!1];if(b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="slider",b[a.id].elem.css({width:c.width+"px",height:c.height+"px"});var f=document.createElement("div");$(f).attr("data",a.id),c.componentName="slider_plugin",b[a.id].obj=$(f),$(f).addClass("slider_plugin");var g=document.createElement("div");$(g).css({position:"absolute",top:"0px",width:"100%",height:"100%",background:"rgba(255, 0, 0, 0.51)"});var h="horizontal";1==c.orientation&&(h="vertical",$(f).css({height:c.height+"px"}),$(f).find(".ui-slider-handle").css({left:"-0.7em"})),$(f).slider({orientation:h,disabled:e[c.disable],animate:d[c.animate],min:Number(c.min),max:Number(c.max),step:Number(c.step),value:Number(c.value),start:function(c,d){j(d.value),b[a.id].listener&&b[a.id].listener({event:"start",data:{value:d.value}})},slide:function(c,d){j(d.value),b[a.id].listener&&b[a.id].listener({event:"slide",data:{value:d.value}})},stop:function(c,d){j(d.value),b[a.id].listener&&b[a.id].listener({event:"stop",data:{value:d.value}}),b.audio.playEffect("click")}}),1==c.orientation&&($(f).css({height:c.height+"px"}),$(f).find(".ui-slider-handle").css({left:"-0.7em"})),0==c.showLabel&&$(f).append("<div class='sliderLabel' style='position:absolute;top:0px;right:0px;font-size:"+c.fontSize+"px;color:"+c.color+"'></div>"),j(c.value),b[a.id].read=function(a,b){var d;switch(a){case"value":d=$(f).slider("value");break;case"domElem":d=f;break;case"config":d=c;break;case"left":d=$(f).offset().left;break;case"top":d=$(f).offset().top;break;case"width":d=$(f).width();break;case"height":d=$(f).height();break;case"css":d=css(f)}return d},b[a.id].write=function(a,b){switch(a){case"min":$(f).slider("option","min",b);break;case"max":$(f).slider("option","max",b);break;case"disable":$(f).slider("option","disabled",!0);break;case"enable":$(f).slider("option","disabled",!1);break;case"value":$(f).slider("value",b);break;case"show":$(f).show();break;case"hide":$(f).hide();break;case"css":$(f).css(b)}},b.updateElementHolder(c,f),b.closeElementHolder(c)}},ScreenController.prototype.addTable=function(a){function l(d){var e="";k%2&&1==c.tableType&&(e="background:"+c.stripColor);for(var f="<tr style='"+e+"'>",g=0;g<d.length;g++)f+="<td>"+parseFloat(d[g]).toFixed(c.floatingPts)+"</td>";f+="</tr>",k++,b[a.id].tableBody.append(f)}var b=this,c={id:"table_1",func:"addTable",parentComponent:"table",cls:"table_plugin",x:0,y:0,width:340,height:340,opacity:1,color:"#000000",background:"#ffffff",columns:2,header:"x,y",fontSize:36,tableType:0,stripColor:"#d4d4d4",outerPadding:15,floatingPts:2,startTime:0,stopTime:0};a.parentComponent="table",a.cls="table_plugin";if(b.updateObjKeys(c,a),b[a.id])b.error("id exists");else{b.createElementHolder(c),b[a.id].target="table";var e=$("<div></div>");e.attr("class","tableHolder"),e.attr("id",a.id),e.css({width:c.width+"px",height:c.height+"px",background:c.background,opacity:c.opacity,"text-align":"center",padding:c.outerPadding+"px",color:c.color});var f=$('<table width="100%" height="100%" class="table table-bordered table-condensed" style="margin-bottom:0px"></table>');e.append(f),f.attr("data",a.id),b[a.id].obj=f,c.componentName="table_plugin",f.addClass("table_plugin"),1==c.tableType&&f.addClass("table-striped"),f.css("font-size",c.fontSize+"px");for(var g="<thead > <tr>",h=c.header.split(","),i=0;i<c.columns;i++)g+="<td style='text-align:center;font-weight:bold'>"+h[i]+"</td>";g+="</tr></thead>",b[a.id].tableHeder=$(g),b[a.id].tableBody=$("<tbody></tbody>"),f.append(b[a.id].tableHeder),f.append(b[a.id].tableBody);var j=document.createElement("div");$(j).addClass("_dragHandle"),b[a.id].showDrag=function(a){a?$(j).show():$(j).hide()},b[a.id].write=function(a,b){switch(console.log("table write"),a){case"show":f.show();break;case"hide":f.hide();break;case"row":l(b);break;case"print":var c=$(f)[0].innerHTML,d="<table border='1' cellpadding='5'>";d+=c,d+="</table>",Popup(d);break;case"css":f.css(b)}};var k=0;b[a.id].read=function(a,b){var d;switch(a){case"domElem":d=f;break;case"config":d=c;break;case"left":d=$(f).offset().left;break;case"top":d=$(f).offset().top;break;case"width":d=$(f).width();break;case"height":d=$(f).height();break;case"css":d=css(f)}return d},b[a.id].write("rows",[1,1]),b.updateElementHolder(c,e),b.closeElementHolder(c),applyCustomScrollBar(e,"dark-3","outside")}};
